title Furniture Science 0.9.87

author vexorian
homepage vexorian.com


background_color #000000
text_color #BEA03B

(debug
verbose_logging)
again_interval 0.03
(again_interval 1.0)
run_rules_on_level_start
realtime_interval 0.25

level_select
mouse_left MouseButton:left
mouse_right MouseButton:right

(key_repeat_interval 0.15)
norepeat_action
(
zlib License

Copyright (c) 2021, Victor Hugo Soliz Kuncar

This software is provided 'as-is', without any express or implied
warranty. In no event will the authors be held liable for any damages
arising from the use of this software.

Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely, subject to the following restrictions:

1. The origin of this software must not be misrepresented; you must not
   claim that you wrote the original software. If you use this software
   in a product, an acknowledgment in the product documentation would be
   appreciated but is not required.
2. Altered source versions must be plainly marked as such, and must not be
   misrepresented as being the original software.
3. This notice may not be removed or altered from any source distribution.

)


( Some comments here


1. I really wanted to make logic for when you push a portal against a block, it would teleport the block through the other portal. But this
has proven really difficult for puzzle script, so for now pushing portals towards other objects won't allow them to push


)


=======
TAGS
=======
color          = yellow white
portal_color   = blue orange
weapon_status  = blue orange disarmed
aU = yU nU
aD = yD nD
aR = yR nR
aL = yL nL

vertical_tag   = down up
horizontal_tag = left right
directions_tag = up down left right
player_face    = up down left right front

smod3 = s0 s1 s2

=========
MAPPINGS
=========

portal_color => toggle_portal_color
blue orange  -> orange blue

directions         => rotate_directions_cw
up right down left -> right down left up

directions         => rotate_directions_cnw
up left down right -> left down right up

vertical_tag => flip_vertical
up down      -> down up

horizontal_tag => flip_horizontal
left right     -> right left

directions         => opposite_directions
up right down left -> down left up right


========
OBJECTS
========

Background
#333333

GroundTop
#3F3F3F
00000
.....
.....
.....
.....

GroundLeft
#3F3F3F
0....
0....
0....
0....
0....

GroundRight
#292929
....0
....0
....0
....0
....0

GroundBottom
#292929
.....
.....
.....
.....
00000



Wall
#c8c8c8 #efefef #b0b0b0 #ffffff
00000
00000
00000
00000
00000


WallOdd
#c8c8c8 #efefef #b0b0b0 #ffffff
22222
22222
22222
22222
22222

(#d8d8d8 #efefef #a0a0a0
11111
10002
10002
10002
22222)

WallTop:white
#ffffff
00000
.....
.....
.....
.....

(transparent
#d8d8d8 #efefef #c0c0c0 #ffffff
33333
.222.
.....
.....
.....)

WallLeft:white
#ffffff
0....
0....
0....
0....
0....


(transparent
#d8d8d8 #efefef #c0c0c0 #ffffff
3....
32...
32...
32...
3....)

WallRight:white
#d8d8d8 #efefef #c0c0c0 #181818
....3
....3
....3
....3
....3

WallBottom:white
#d8d8d8 #efefef #c0c0c0 #181818
.....
.....
.....
.....
33333

WallDarkCorner:white
#181818
.....
.....
.....
.....
....0

Wallx1:white
transparent




DarkWall
#222222 #242424 #262626 #282828
00000
03010
00000
03020
00000

(
#222222 #242424 #262626 #282828
00331
00130
31301
03210
01232)

(DarkWallSprite1
#222222 #242424 #262626 #282828
30022
22311
31220
02012
22212

DarkWallSprite2
#222222 #242424 #262626 #282828
23201
20201
03123
10302
21222

DarkWallSprite3
#222222 #242424 #262626 #282828
01200
22020
11002
22223
01312)


DarkWallSprite1
#222222 #242424 #262626 #282828
00000
01020
00000
03010
00000

DarkWallSprite2
#222222 #242424 #262626 #282828
00000
02020
00000
03010
00000

DarkWallSprite3
#222222 #242424 #262626 #282828
00000
02030
00000
01030
00000

DarkWallSprite4
transparent

HintTerminal1
black #BEA03B
00000
01100
00010
01000
00000

HintTerminal2
black #BEA03B #CEB04B
00000
01100
00010
01200
00000


DarkWallTop
#454545
00000
.....
.....
.....
.....

DarkWallLeft
#454545
0....
0....
0....
0....
0....

DarkWallRight
#101010
....0
....0
....0
....0
....0

DarkWallBottom
#101010
.....
.....
.....
.....
00000

WallSeparatorD
#2B2B2B
.....
.....
.....
.....
00000

WallSeparatorU
#2B2B2B
00000
.....
.....
.....
.....

WallSeparatorL
#2B2B2B
0....
0....
0....
0....
0....



WallSeparatorR
#2B2B2B
....0
....0
....0
....0
....0



Portal1RS1
#1A4FDF #073CCF
....1
...01
...01
...01
....1
Portal:blue:right
#1541B7 #1D57F7
....1
...01
...01
...01
....1
Portal1RS2
transparent
Portal1RS3
#285BE6 #4B79F9
....1
...01
...01
...01
....1
Portal1RS4
transparent

Portal1LS1
#1A4FDF #073CCF
1....
10...
10...
10...
1....
Portal:blue:left
#1541B7 #1D57F7
1....
10...
10...
10...
1....
Portal1LS2
transparent
Portal1LS3
#285BE6 #4B79F9
1....
10...
10...
10...
1....
Portal1LS4
transparent

Portal1DS1
#1A4FDF #073CCF
.....
.....
.....
.000.
11111
Portal:blue:down
#1541B7 #1D57F7
.....
.....
.....
.000.
11111
Portal1DS2
transparent
Portal1DS3
#285BE6 #4B79F9
.....
.....
.....
.000.
11111
Portal1DS4
transparent

Portal1US1
#1A4FDF #073CCF
11111
.000.
.....
.....
.....
Portal:blue:up
#1541B7 #1D57F7
11111
.000.
.....
.....
.....
Portal1US2
transparent
Portal1US3
#285BE6 #4B79F9
11111
.000.
.....
.....
.....
Portal1US4
transparent


Portal2RS1
#DF6D1A #CF5B07
....1
...01
...01
...01
....1
Portal:orange:right
#B75915 #F7791D
....1
...01
...01
...01
....1
Portal2RS2
transparent
Portal2RS3
#E67828 #F9944B
....1
...01
...01
...01
....1
Portal2RS4
transparent

Portal2LS1
#DF6D1A #CF5B07
1....
10...
10...
10...
1....
Portal:orange:left
#B75915 #F7791D
1....
10...
10...
10...
1....
Portal2LS2
transparent
Portal2LS3
#E67828 #F9944B
1....
10...
10...
10...
1....
Portal2LS4
transparent

Portal2DS1
#DF6D1A #CF5B07
.....
.....
.....
.000.
11111

Portal:orange:down
#B75915 #F7791D
.....
.....
.....
.000.
11111

Portal2DS2
transparent

Portal2DS3
#E67828 #F9944B
.....
.....
.....
.000.
11111
Portal2DS4
transparent

Portal2US1
#DF6D1A #CF5B07
11111
.000.
.....
.....
.....
Portal:orange:up
#B75915 #F7791D
11111
.000.
.....
.....
.....
Portal2US2
transparent
Portal2US3
#E67828 #F9944B
11111
.000.
.....
.....
.....
Portal2US4
transparent





Target
#E8D138
.....
.000.
.0.0.
.000.
.....

TargetBorderTop
#E8D138
..0..
.....
.....
.....
.....
TargetBorderBottom
#E8D138
.....
.....
.....
.....
..0..

TargetBorderLeft
#E8D138
.....
.....
0....
.....
.....

TargetBorderRight
#E8D138
.....
.....
....0
.....
.....


Player:blue:front
black #DF60E2 #2A0B25 #45113D white blue
.000.
.010.
.054.
.000.
.3.3.

Player:blue:left
black #DF60E2 #2A0B25 #45113D white blue
..000
00010
54002
00002
..3.3


Player:blue:right
black #DF60E2 #2A0B25 #45113D white blue
000..
01000
20045
20000
3.3..

Player:blue:up
black #DF60E2 #2A0B25 #45113D white blue
00050
00040
0200.
020..
3.3..


Player:blue:down
black #DF60E2 #2A0B25 #45113D white blue
222..
000..
0100.
00040
3.050

Player:orange:front
black #DF60E2 #2A0B25 #45113D white Orange
.000.
.010.
.054.
.000.
.3.3.

Player:orange:left
black #DF60E2 #2A0B25 #45113D white Orange
..000
00010
54002
00002
..3.3


Player:orange:right
black #DF60E2 #2A0B25 #45113D white Orange
000..
01000
20045
20000
3.3..

Player:orange:up
black #DF60E2 #2A0B25 #45113D white Orange
00050
00040
0200.
020..
3.3..


Player:orange:down
black #DF60E2 #2A0B25 #45113D white Orange
222..
000..
0100.
00040
3.050






SinkingPlayerSprite1
#0F3318 #3DD162
.000.
.000.
.000.
.000.
.0.0.

SinkingPlayerSprite2
#0F3318 #3DD162
..0..
.000.
..0..
..00.
.0...

SinkingPlayerSprite3
#0F3318 #3DD162
..0..
.0.0.
.....
..0..
.0...

Player:disarmed:front
black #DF60E2 #2A0B25 #45113D
.000.
.010.
.000.
.000.
.3.3.



Player:disarmed:left
black #DF60E2 #2A0B25 #45113D
.000.
.010.
00002
.0002
.3.3.


Player:disarmed:right
black #DF60E2 #2A0B25 #45113D
.000.
.010.
20000
2000.
.3.3.


Player:disarmed:up
black #DF60E2 #2A0B25 #45113D
.000.
.000.
.020.
.020.
.3.3.


Player:disarmed:down
black #DF60E2 #2A0B25 #45113D
.222.
.000.
.010.
.000.
.3.3.


PortalGunTM
black blue orange white
..0.. 
0.1.0
.020.
.030.
..0..


Shot:blue:right
blue
.....
...0.
....0
...0.
.....

Shot1ParticleSprite1L
blue
.....
0....
.....
0....
.....

Shot1ParticleSprite2L
blue
0....
.....
.....
.....
0....


Shot:blue:left
blue
.....
.0...
0....
.0...
.....

Shot1ParticleSprite1R
blue
.....
....0
.....
....0
.....

Shot1ParticleSprite2R
blue
....0
.....
.....
.....
....0


Shot:blue:up
blue
..0..
.0.0.
.....
.....
.....


Shot1ParticleSprite1D
blue
.....
.....
.....
.....
.0.0.

Shot1ParticleSprite2D
blue
.....
.....
.....
.....
0...0


Shot:blue:down
blue
.....
.....
.....
.0.0.
..0..

Shot1ParticleSprite1U
blue
.0.0.
.....
.....
.....
.....

Shot1ParticleSprite2U
blue
0...0
.....
.....
.....
.....


ShotF:blue:right
blue
.....
...0.
....0
...0.
.....

ShotF:blue:left
blue
.....
.0...
0....
.0...
.....


ShotF:blue:up
blue
..0..
.0.0.
.....
.....
.....

ShotF:blue:down
blue
.....
.....
.....
.0.0.
..0..




Shot:orange:right
Orange
.....
...0.
....0
...0.
.....

Shot2ParticleSprite1L
Orange
.....
0....
.....
0....
.....

Shot2ParticleSprite2L
Orange
0....
.....
.....
.....
0....


Shot:orange:left
Orange
.....
.0...
0....
.0...
.....

Shot2ParticleSprite1R
Orange
.....
....0
.....
....0
.....

Shot2ParticleSprite2R
Orange
....0
.....
.....
.....
....0


Shot:orange:up
Orange
..0..
.0.0.
.....
.....
.....


Shot2ParticleSprite1D
Orange
.....
.....
.....
.....
.0.0.

Shot2ParticleSprite2D
Orange
.....
.....
.....
.....
0...0


Shot:orange:down
Orange
.....
.....
.....
.0.0.
..0..

Shot2ParticleSprite1U
Orange
.0.0.
.....
.....
.....
.....

Shot2ParticleSprite2U
Orange
0...0
.....
.....
.....
.....


ShotF:orange:right
Orange
.....
...0.
....0
...0.
.....

ShotF:orange:left
Orange
.....
.0...
0....
.0...
.....


ShotF:orange:up
Orange
..0..
.0.0.
.....
.....
.....

ShotF:orange:down
Orange
.....
.....
.....
.0.0.
..0..







Water
#1D7C6B #83867A
00000
10000
00000
00010
00000

WaterSprite1
#1D7C6B #83867A
00000
00100
00000
01000
00000

WaterSprite2
#1D7C6B #83867A
00000
00010
00000
00100
00000

WaterSprite3
#1D7C6B #83867A
00010
00000
00000
01000
00000

WaterSprite4
transparent

Block____:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
.000.
01412
04342
01412
.222.

Block___R:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
.0000
01411
04341
01411
.2222


Block__L_:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
0000.
11412
14342
11412
2222.

Block__LR:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
00000
11411
14341
11411
22222


Block_D__:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
.000.
01412
04342
01412
01112


Block_D_R_1:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
.0000
01411
04341
01411
01112


Block_D_R_2:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
.0000
01411
04341
01411
01111

Block_DL__1:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
0000.
11412
14342
11412
11112


Block_DL__2:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
0000.
11412
14342
11412
11112


Block_DLR:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
00000
11411
14341
11411
11112

BlockU___:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
01412
04342
01412
.222.

BlockU__R_1:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
01411
04341
01411
.2222

BlockU__R_2:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01111
01411
04341
01411
.2222

BlockU_L__1:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
11412
14342
11412
2222.


BlockU_L__2:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
11112
11412
14342
11412
2222.

BlockU_LR:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
11411
14341
11411
22222

BlockUD__:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
01412
04342
01412
01112


BlockUD_R:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
01411
04341
01411
01112

BlockUDL_:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
01112
11412
14342
11412
11112



BlockUDLR_1:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
21110
11411
14341
11411
01112


BlockUDLR_2:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
11111
11411
14341
11411
11111

BlockStub:aU:aD:aL:aR:yellow
#E5D98B #D4BF33 #1F1B07 #B6A42C #E8D138
1.1.1
.111.
11341
.141.
1.1.1


BlockStub:aU:aD:aL:aR:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
1.1.1
.111.
11341
.141.
1.1.1



Block____:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
.000.
03332
03332
03332
.222.

Block___R:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
.0000
01411
04341
01411
.2222


Block__L_:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
0000.
11412
14342
11412
2222.

Block__LR:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
00000
11411
14341
11411
22222


Block_D__:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
.000.
01412
04342
01412
01112


Block_D_R_1:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
.0000
01411
04341
01411
01112


Block_D_R_2:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
.0000
01411
04341
01411
01111

Block_DL__1:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
0000.
11412
14342
11412
11112


Block_DL__2:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
0000.
11412
14342
11412
11112


Block_DLR:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
00000
11411
14341
11411
11112

BlockU___:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
01412
04342
01412
.222.

BlockU__R_1:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
01411
04341
01411
.2222

BlockU__R_2:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01111
01411
04341
01411
.2222

BlockU_L__1:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
11412
14342
11412
2222.


BlockU_L__2:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
11112
11412
14342
11412
2222.

BlockU_LR:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
11411
14341
11411
22222

BlockUD__:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
01412
04342
01412
01112


BlockUD_R:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
01411
04341
01411
01112

BlockUDL_:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
01112
11412
14342
11412
11112



BlockUDLR_1:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
21110
11411
14341
11411
01112


BlockUDLR_2:white
#FFFFFF #e0e0e0 #232323 #e0e0e0 #e0e0e0
11111
11411
14341
11411
11111


Bridge____:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
34443
40004
40124
42224
34443

Bridge___R:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
34444
40000
40112
42222
34444


Bridge__L_:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
44443
00004
11124
22224
44443


Bridge__LR:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
44444
00000
11111
22222
44444



Bridge_D__:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
34443
40004
40124
40124
40124



Bridge_D_R_1:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
34444
40000
40111
40112
40124



Bridge_D_R_2:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
34444
40000
40111
40111
40111

Bridge_DL__1:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
44443
00004
11124
21124
40124


Bridge_DL__2:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
44443
00004
11124
11124
11124


Bridge_DLR:white
#B66F26 #A46422 #9C5F20 #1D7C6B
00000
11111
11111
11111
21112

BridgeU___:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40124
40124
40124
42224
34443


BridgeU__R_1:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40124
40110
40111
42222
34444

BridgeU__R_2:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40111
40111
40111
42222
34444

BridgeU_L__1:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40124
00124
11124
22224
44443


BridgeU_L__2:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
11124
11124
11124
22224
44443

BridgeU_LR:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40124
00120
11111
22222
44444

BridgeUD__:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
40124
40124
40124
40124
40124



BridgeUD_R:white
#B66F26 #A46422 #9C5F20 #1D7C6B
01112
01111
01111
01111
01112

BridgeUDL_:white
#B66F26 #A46422 #9C5F20 #1D7C6B
01112
11112
11112
11112
21112



BridgeUDLR_1:white
#B66F26 #A46422 #9C5F20 #1D7C6B
21110
11111
11111
11111
01112


BridgeUDLR_2:white
#72F1DA #68DCC7 #63D1BD #1D7C6B #1B7162
11111
11111
11111
11111
11111




Bridge____:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
34443
40004
40124
42224
34443

Bridge___R:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
34444
40000
40112
42222
34444


Bridge__L_:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
44443
00004
11124
22224
44443


Bridge__LR:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
44444
00000
11111
22222
44444



Bridge_D__:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
34443
40004
40124
40124
40124



Bridge_D_R_1:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
34444
40000
40111
40112
40124



Bridge_D_R_2:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
34444
40000
40111
40111
40111

Bridge_DL__1:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
44443
00004
11124
21124
40124


Bridge_DL__2:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
44443
00004
11124
11124
11124


Bridge_DLR:yellow
#B66F26 #A46422 #9C5F20 #1D7C6B
00000
11111
11111
11111
21112

BridgeU___:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
40124
40124
40124
42224
34443


BridgeU__R_1:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
40124
40110
40111
42222
34444

BridgeU__R_2:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
40111
40111
40111
42222
34444

BridgeU_L__1:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
40124
00124
11124
22224
44443


BridgeU_L__2:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
11124
11124
11124
22224
44443

BridgeU_LR:yellow
#B66F26 #A46422 #9C5F20 #1D7C6B
01112
11111
11111
11111
22222

BridgeUD__:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
40124
40124
40124
40124
40124



BridgeUD_R:yellow
#B66F26 #A46422 #9C5F20 #1D7C6B
01112
01111
01111
01111
01112

BridgeUDL_:yellow
#B66F26 #A46422 #9C5F20 #1D7C6B
01112
11112
11112
11112
21112



BridgeUDLR_1:yellow
#B66F26 #A46422 #9C5F20 #1D7C6B
21110
11111
11111
11111
01112


BridgeUDLR_2:yellow
#4EE874 #38E864 #34D95D #1D7C6B #1B7162
11111
11111
11111
11111
11111


Want:left
red blue
.....
.....
.01..
.....
.....


Want:right
red blue
.....
.....
..10.
.....
.....


Want:up
red blue
.....
..0..
..1..
.....
.....


Want:down
red blue
.....
.....
..1..
..0..
.....


Error
black
.....
.0.0.
..0..
.0.0.
.....

PostError
red
.....
..0..
.0.0.
..0..
.....


(

WantL
transparent

WantR
transparent

WantU
transparent

WantD
transparent

Error
transparent

PostError
transparent


)

MightSink
transparent


Origin:directions
transparent

PortalExit:portal_color:directions
transparent


ActivePortal:directions
transparent


RotateRR
transparent

RotateRL
transparent

RotateRU
transparent

RotateRD
transparent

RotateLR
transparent

RotateLL
transparent

RotateLU
transparent

RotateLD
transparent

RotateUR
transparent

RotateUL
transparent

RotateUU
transparent 

RotateUD
transparent

RotateDR
transparent

RotateDL
transparent

RotateDU
transparent

RotateDD
transparent




OkRigidL
transparent

OkRigidR
transparent

OkRigidD
transparent

OkRigidU
transparent

RigidEnteringPortal1
transparent

RigidLeavingPortal1
transparent

RigidEnteringPortal2
transparent

RigidLeavingPortal2
transparent


BPEnteringPortal1
transparent

BPEnteringPortal2
transparent

BPLeavingPortal1
transparent

BPLeavingPortal2
transparent

NoPortal1
transparent

NoPortal2
transparent

ColorToggle
transparent

MouseButton:horizontal
transparent


GotGun
transparent


HasCellU
transparent

HasCellD
transparent

HasCellL
transparent

HasCellR
transparent

RealTimeTick
transparent

U0
#424242
.....
.....
.....
.000.
.0.0.	

D0
#424242
.0.0.
.0.0.
.000.
.....
.....

U1
#424242
.....
.....
.....
..0..
.00..

D1
#424242
..0..
..0..
.000.
.....
.....

U2
#424242
.....
.....
.....
.000.
...0.

D2
#424242
.000.
.0...
.000.
.....
.....

D3
#424242
.000.
...0.
.000.
.....
.....

U4
#424242
.....
.....
.....
.0.0.
.0.0.

D4
#424242
.000.
...0.
...0.
.....
.....

U5
#424242
.....
.....
.....
.000.
.0...

D6
#424242
.000.
.0.0.
.000.
.....
.....


D7
#424242
...0.
...0.
...0.
.....
.....

B0
red
.000.
.0.0.
.0.0.
.0.0.
.000.

B1
red
...0.
...0.
...0.
...0.
...0.

B2
red
.000.
...0.
.000.
.0...
.000.

B3
red
.000.
...0.
.000.
...0.
.000.

B4
red
.0.0.
.0.0.
.000.
...0.
...0.


B5
red
.000.
.0...
.000.
...0.
.000.


B6
red
.000.
.0...
.000.
.0.0.
.000.


B7
red
.000.
...0.
...0.
...0.
...0.


B8
red
.000.
.0.0.
.000.
.0.0.
.000.

B9
red
.000.
.0.0.
.000.
...0.
.000.



PlayerNotFound
red
.....
.000.
.0.0.
.000.
.....

ThroughPortal:directions
transparent

FutureUsed
transparent

RigidLNextToPortal
transparent

RigidRNextToPortal
transparent

RigidUNextToPortal
transparent

RigidDNextToPortal
transparent

UnmovablePortal
transparent

ErrorSprite
red
00.00
0...0
.....
0...0
00.00



ConveyorLeft
black
..0..
...0.
..0..
.0...
0....

JustTurned
transparent

Pointer
transparent

PointerEnd
transparent

EmptySpot
transparent

GoalSoundSprite
#F7DC43 yellow
.....
.000.
.010.
.000.
.....

CellOdd
transparent

CellEven
transparent


MissingPlayer
transparent

LightBridgeStarter:down
gray
00000
.....
.....
.....
.....

LightBridgeStarter:up
gray
.....
.....
.....
.....
00000

LightBridgeStarter:left
gray
....0
....0
....0
....0
....0

LightBridgeStarter:right
gray
0....
0....
0....
0....
0....

LightBridge:directions
transparent

LightBridgeSprite:s0:left
#A8006A #B80074 #E0008E #FF2EB3
.....
33333
01210
33333
.....

LightBridgeSprite:s1:left
#A8006A #B80074 #E0008E #FF29B1
.....
33333
12100
33333
.....

LightBridgeSprite:s2:left
#A8006A #B80074 #E0008E #FF33B5
.....
33333
10012
33333
.....

LightBridgeSprite:s0:right
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s0:left
flip:v

LightBridgeSprite:s1:right
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s1:left
flip:v

LightBridgeSprite:s2:right
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s2:left
flip:v


LightBridgeSprite:s0:down
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s0:left
rot:left:down

LightBridgeSprite:s1:down
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s1:left
rot:left:down

LightBridgeSprite:s2:down
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s2:left
rot:left:down

LightBridgeSprite:s0:up
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s0:left
rot:left:up

LightBridgeSprite:s1:up
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s1:left
rot:left:up

LightBridgeSprite:s2:up
#A8006A #B80074 #E0008E #FF33B5
copy:LightBridgeSprite:s2:left
rot:left:up


LightBridgeEnteringPortal:portal_color
transparent


=======
LEGEND
=======

. = Background
# = Wall
% = DarkWall
! = Player:blue:front and Background
¡ = Player:disarmed:front and Background

ñ = Block____:yellow
⅄ = Block___R:yellow
☥ = Block__L_:yellow
ⱬ = Block__LR:yellow
┦ = Block_D__:yellow
⡧ = Block_D_R_1:yellow
ℌ = Block_DL__1:yellow
╎ = Block_DLR:yellow
⹏ = BlockU___:yellow
⸔ = BlockU__R_1:yellow
A = BlockU_L__1:yellow
B = BlockU_LR:yellow
C = BlockUD__:yellow
E = BlockUDL_:yellow
F = BlockUDLR_1:yellow

S = Block_D_R_2:yellow
G = Block_DL__2:yellow
P = BlockU__R_2:yellow
N = BlockU_L__2:yellow
K = BlockUDLR_2:yellow

} = Block____:white
“ = Block___R:white
» = Block__L_:white
· = Block__LR:white
µ = Block_D__:white
½ = Block_D_R_1:white
¬ = Block_DL__1:white
{ = Block_DLR:white
¶ = BlockU___:white
\ = BlockU__R_1:white
æ = BlockU_L__1:white
” = BlockU_LR:white
¢ = BlockUD__:white
ð = BlockUD_R:white
€ = BlockUDL_:white
đ = BlockUDLR_1:white
ß = Block_D_R_2:white
ŋ = Block_DL__2:white
þ = BlockU__R_2:white
ł = BlockU_L__2:white
ĸ = BlockUDLR_2:white


~ = Water

@ = Target
T = PortalGunTM

H = HintTerminal1 and DarkWall

0 = b0
1 = b1
2 = b2
3 = b3
4 = b4
5 = b5
6 = b6
7 = b7
8 = b8
9 = b9



_  = ConveyorLeft

↓ = LightBridgeStarter:down
« = LightBridgeStarter:up
ħ = LightBridgeStarter:right
ŧ = LightBridgeStarter:left


Y = BlockStub:yU:yD:yL:yR:yellow
W = BlockStub:yU:yD:yL:yR:white

HintTerminal = HintTerminal1 or HintTerminal2

Block_D_R:color = Block_D_R_1:color or Block_D_R_2:color
Block_DL_:color = Block_DL__1:color or Block_DL__2:color
BlockU__R:color = BlockU__R_1:color or BlockU__R_2:color
BlockU_L_:color = BlockU_L__1:color or BlockU_L__2:color
BlockUDLR:color = BlockUDLR_1:color or BlockUDLR_2:color


b3U:color = BlockStub:yU:yD:yL:nR:color or BlockStub:yU:yD:nL:yR:color or BlockStub:yU:nD:yL:yR:color
b3D:color = BlockStub:yU:yD:yL:nR:color or BlockStub:yU:yD:nL:yR:color or BlockStub:nU:yD:yL:yR:color
b3L:color = BlockStub:yU:yD:yL:nR:color or BlockStub:yU:nD:yL:yR:color or BlockStub:nU:yD:yL:yR:color
b3R:color = BlockStub:nU:yD:yL:nR:color or BlockStub:yU:nD:yL:yR:color or BlockStub:yU:yD:nL:yR:color

b2U:color = BlockStub:yU:yD:nL:nR:color or BlockStub:yU:nD:yL:nR:color or BlockStub:yU:nD:nL:yR:color
b2D:color = BlockStub:yU:yD:nL:nR:color or BlockStub:nU:yD:yL:nR:color or BlockStub:nU:yD:nL:yR:color
b2L:color = BlockStub:yU:nD:yL:nR:color or BlockStub:nU:yD:yL:nR:color or BlockStub:nU:nD:yL:yR:color
b2R:color = BlockStub:yU:nD:nL:yR:color or BlockStub:nU:yD:nL:yR:color or BlockStub:nU:nD:yL:yR:color

BlockStub3U:color = b3U:color
BlockStub3D:color = b3D:color
BlockStub3L:color = b3L:color
BlockStub3R:color = b3R:color

BlockStub2U:color = b2U:color
BlockStub2D:color = b2D:color
BlockStub2L:color = b2L:color
BlockStub2R:color = b2R:color


BlockStubWithU:color = BlockStub:yU:aD:aL:aR:color
BlockStubWithD:color = BlockStub:aU:yD:aL:aR:color
BlockStubWithL:color = BlockStub:aU:aD:yL:aR:color
BlockStubWithR:color = BlockStub:aU:aD:aL:yR:color

Bridge_D_R:color = Bridge_D_R_1:color or Bridge_D_R_2:color
Bridge_DL_:color = Bridge_DL__1:color or Bridge_DL__2:color
BridgeU__R:color = BridgeU__R_1:color or BridgeU__R_2:color
BridgeU_L_:color = BridgeU_L__1:color or BridgeU_L__2:color
BridgeUDLR:color = BridgeUDLR_1:color or BridgeUDLR_2:color



Bridge____ = Bridge____:color
Bridge___R = Bridge___R:color
Bridge__L_ = Bridge__L_:color
Bridge__LR = Bridge__LR:color
Bridge_D__ = Bridge_D__:color
Bridge_D_R = Bridge_D_R:color
Bridge_DL_ = Bridge_DL_:color
Bridge_DLR = Bridge_DLR:color
BridgeU___ = BridgeU___:color
BridgeU__R = BridgeU__R:color
BridgeU_L_ = BridgeU_L_:color
BridgeU_LR = BridgeU_LR:color
BridgeUD__ = BridgeUD__:color
BridgeUD_R = BridgeUD_R:color
BridgeUDL_ = BridgeUDL_:color
BridgeUDLR = BridgeUDLR:color

Bridge_D_R_1 = Bridge_D_R_1:color
Bridge_D_R_2 = Bridge_D_R_2:color
Bridge_DL__1 = Bridge_DL__1:color
Bridge_DL__2 = Bridge_DL__2:color
BridgeU__R_1 = BridgeU__R_1:color
BridgeU__R_2 = BridgeU__R_2:color
BridgeU_L__1 = BridgeU_L__1:color
BridgeU_L__2 = BridgeU_L__2:color
BridgeUDLR_1 = BridgeUDLR_1:color
BridgeUDLR_2 = BridgeUDLR_2:color

Bridge1 = BridgeU___ or Bridge_D__ or Bridge__L_ or Bridge___R
Bridge2 = BridgeUD__ or BridgeU_L_ or BridgeU__R or Bridge_DL_ or Bridge_D_R or Bridge__LR
Bridge3 = BridgeUDL_ or BridgeUD_R or BridgeU_LR or Bridge_DLR
Bridge = Bridge____ or Bridge1 or Bridge2 or Bridge3 or BridgeUDLR 


Player:blue = Player:blue:front or Player:blue:directions

Player:orange = Player:orange:front or Player:orange:directions

Player:disarmed = Player:disarmed:front or Player:disarmed:directions




RealPlayer = Player:blue or Player:orange or Player:disarmed
Player = RealPlayer or MissingPlayer


With:left = Block__L_:color or Block__LR:color or Block_DL_:color or Block_DLR:color or  BlockU_L_:color or  BlockU_LR:color or BlockUDL_:color or BlockUDLR:color or BlockStubWithL:color or BlockStub2L:color
With:right = Block___R:color or Block__LR:color or Block_D_R:color or Block_DLR:color or BlockU__R:color or BlockU_LR:color or BlockUD_R:color or BlockUDLR:color or BlockStubWithR:color or BlockStub2R:color
With:up = BlockU___:color or BlockU__R:color or BlockU_L_:color or BlockU_LR:color or BlockUD__:color or BlockUD_R:color or BlockUDL_:color or BlockUDLR:color or BlockStubWithU:color or BlockStub2U:color
With:down = Block_D__:color or Block_D_R:color or Block_DL_:color  or Block_DLR:color  or BlockUD__:color  or BlockUD_R:color  or BlockUDL_:color  or BlockUDLR:color  or BlockStubWithD:color or BlockStub2D:color
 
 

 
Block = With:left or With:right or With:up or With:down or Block____:color or BlockStub:nU:nD:nL:nR:color
WithCollision = Block or Player or Wall or DarkWall

BlockPlayer = Block or RealPlayer

WantL = Want:left
WantR = Want:right
WantD = Want:down
WantU = Want:up

Want = WantL or WantR or WantU or WantD
WantNotD = WantR or WantL or WantU
WantNotU = WantR or WantL          or WantD
WantNotR =          WantL or WantU or WantD
WantNotL = WantR          or WantU or WantD
WantH = WantL or WantR
WantV = WantD or WantU

OriginL = Origin:left
OriginR = Origin:right
OriginD = Origin:down
OriginU = Origin:up

Origin = OriginL or OriginR or OriginD or OriginU

Portal:blue   = Portal:blue:directions
Portal:orange = Portal:orange:directions

Portal = Portal:portal_color:directions


Portal:right = Portal:portal_color:right
Portal:left  = Portal:portal_color:left
Portal:up    = Portal:portal_color:up
Portal:down  = Portal:portal_color:down


PortalExit:blue   = PortalExit:blue:directions
PortalExit:orange = PortalExit:orange:directions

PortalExit = PortalExit:portal_color:directions

ActivePortal = ActivePortal:directions

RotateCW  = RotateLU or RotateUR or RotateRD or RotateDL
RotateCNW = RotateUL or RotateRU or RotateDR or RotateLD
RotatePerpendicular = RotateCW or RotateCNW
FlipVertical = RotateUU or RotateDD
FlipHorizontal = RotateLL or RotateRR
Rotate = RotateRR or RotateRL or RotateRU or RotateRD or RotateLR or RotateLL or RotateLU or RotateLD or RotateUR or RotateUL or RotateUU or RotateUD or RotateDR or RotateDL or RotateDU or RotateDD


OkRigid = OkRigidL or OkRigidD or OkRigidR or OkRigidU

Portal1OrNothing = Portal:blue    or NoPortal1
Portal2OrNothing = Portal:orange  or NoPortal2

BlueShot = Shot:blue:directions
OrangeShot = Shot:orange:directions


Block:white = Block____:white or Block___R:white or Block__L_:white or Block__LR:white or Block_D__:white or Block_D_R_1:white or Block_DL__1:white or Block_DLR:white or BlockU___:white or BlockU__R_1:white or BlockU_L__1:white or BlockU_LR:white or BlockUD__:white or BlockUD_R:white or BlockUDL_:white or BlockUDLR_1:white or Block_D_R_2:white or Block_DL__2:white or BlockU__R_2:white or BlockU_L__2:white or BlockUDLR_2:white

WithWhite = Wall or Block:white

Player:front = Player:disarmed:front or Player:blue:front or Player:orange:front
WaterOrBridge = Water or Bridge
DarkWallSprite = DarkWallSprite1 or DarkWallSprite2 or DarkWallSprite3 or DarkWallSprite4
WaterSprite = WaterSprite1 or WaterSprite2 or WaterSprite3 or WaterSprite4

Portal1SPrite = Portal1RS1 or Portal1RS2 or Portal1RS3 or Portal1RS4 or Portal1LS1 or Portal1LS2 or Portal1LS3 or Portal1LS4 or Portal1US1 or Portal1US2 or Portal1US3 or Portal1US4 or Portal1DS1 or Portal1DS2 or Portal1DS3 or Portal1DS4
Portal2SPrite = Portal2RS1 or Portal2RS2 or Portal2RS3 or Portal2RS4 or Portal2LS1 or Portal2LS2 or Portal2LS3 or Portal2LS4 or Portal2US1 or Portal2US2 or Portal2US3 or Portal2US4 or Portal2DS1 or Portal2DS2 or Portal2DS3 or Portal2DS4

ThroughPortal = ThroughPortal:directions

WithVertical = With:up or With:down
WithHorizontal = With:left or With:right

RigidHNextToPortal = RigidRNextToPortal or RigidLNextToPortal
RigidVNextToPortal = RigidDNextToPortal or RigidUNextToPortal
RigidNextToPortal = RigidHNextToPortal or RigidVNextToPortal

Player:left  = Player:weapon_status:left
Player:right = Player:weapon_status:right
Player:down  = Player:weapon_status:down
Player:up    = Player:weapon_status:up

DarkOrWhiteWall = Wall or DarkWall

LightBridge = LightBridge:directions
LightBridgeSprite:left = LightBridgeSprite:smod3:left
LightBridgeSprite:right = LightBridgeSprite:smod3:right
LightBridgeSprite:up = LightBridgeSprite:smod3:up
LightBridgeSprite:down = LightBridgeSprite:smod3:down

=======
SOUNDS
=======

SFX1 33053303:2 (portal gun)
sfx2 59657701:2 (shoot)
sfx3 57950702:2 (open portal)
sfx4 45276302:2 (teleport)
sfx5 24968106:2 (error)
sfx6 50609104:2 (sinkx)
sfx7 38799704:2 (player sink)
sfx8 22930307:2 (push block)
sfx9 47474505:2 (light error)
sfx10 57390700:2 (goal)
sfx11 86141708:2 (light bridge)

MouseButton:horizontal Destroy 31656906:10


================
COLLISIONLAYERS
================

Background
GroundTop
GroundLeft
GroundRight
GroundBottom

B0, B1, B2, B3, B4, B5, B6, B7, B8, B9, D0, D1, D2, D3, D4, D6, D7, U0, U1, U2, U4, U5

Target
TargetBorderLeft
TargetBorderRight
TargetBorderTop
TargetBorderBottom

Water
WaterSprite
Bridge
SinkingPlayerSprite1, SinkingPlayerSprite2, SinkingPlayerSprite3


LightBridge:horizontal
LightBridge:vertical

LightBridgeEnteringPortal:portal_color
LightBridgeSprite:smod3:horizontal
LightBridgeSprite:smod3:vertical

LightBridgeStarter:directions


BlockPlayer, Wall, DarkWall , PortalGunTM
DarkWallSprite

HintTerminal1, HintTerminal2

WallSeparatorD
WallSeparatorU
WallSeparatorL
WallSeparatorR


DarkWallTop
DarkWallLeft
DarkWallRight
DarkWallBottom
WallOdd
WallTop:white
WallLeft:white
WallRight:white
WallBottom:white
Wallx1:white
WallDarkCorner:white



Shot1ParticleSprite1L, Shot1ParticleSprite2L, Shot1ParticleSprite1U, Shot1ParticleSprite2U, Shot1ParticleSprite1D, Shot1ParticleSprite2D, Shot1ParticleSprite1R, Shot1ParticleSprite2R, Shot2ParticleSprite1L, Shot2ParticleSprite2L, Shot2ParticleSprite1U, Shot2ParticleSprite2U, Shot2ParticleSprite1D, Shot2ParticleSprite2D, Shot2ParticleSprite1R, Shot2ParticleSprite2R  

WantL
WantR
WantD
WantU
Error
PostError
MightSink
OriginL
OriginR
OriginD
OriginU
Portal:blue
Portal1Sprite
Portal:orange
Portal2Sprite
PortalExit:blue
PortalExit:orange
ActivePortal:right
ActivePortal:left
ActivePortal:down
ActivePortal:up
Rotate
OkRigidL
OkRigidR
OkRigidD
OkRigidU
RigidEnteringPortal1
RigidLeavingPortal1
RigidEnteringPortal2
RigidLeavingPortal2
BPEnteringPortal1, BPLeavingPortal1
BPEnteringPortal2, BPLeavingPortal2
NoPortal1
NoPortal2
Shot:portal_color:directions, ShotF:portal_color:directions
ColorToggle
MouseButton:horizontal
GotGun

HasCellU
HasCellD
HasCellR
HasCellL
RealTimeTick
PlayerNotFound

ThroughPortal:up
ThroughPortal:right
ThroughPortal:left
ThroughPortal:down

FutureUsed
RigidNextToPortal
UnmovablePortal

ErrorSprite
ConveyorLeft

JustTurned
Pointer
PointerEnd, EmptySpot
GoalSoundSprite
CellOdd, CellEven
MissingPlayer

======
RULES
======

down [ b0 | b0 ] -> [ u0 | d0 ]
down [ b1 | b1 ] -> [ u1 | d1 ]
down [ b2 | b2 ] -> [ u2 | d2 ]
down [ b3 | b3 ] -> [ u2 | d3 ]
down [ b4 | b4 ] -> [ u4 | d4 ]
down [ b5 | b5 ] -> [ u5 | d3 ]
down [ b6 | b6 ] -> [ u5 | d6 ]
down [ b7 | b7 ] -> [ u2 | d7 ]
down [ b8 | b8 ] -> [ u0 | d6 ]
down [ b9 | b9 ] -> [ u0 | d3 ]
down [ b6 | b0 ] -> [ u5 | d0 ]


startloop
  (Remove U)
  down  [ no With:down | BlockStub:yU:aD:aL:aR:color ] -> [ | BlockStub:nU:aD:aL:aR:color ]
  
  (Remove D)
  up    [ no With:up | BlockStub:aU:yD:aL:aR:color ] -> [ | BlockStub:aU:nD:aL:aR:color ]
  
  (Remove L)
  right [ no With:right | BlockStub:aU:aD:yL:aR:color ] -> [ | BlockStub:aU:aD:nL:aR:color ]
  
  (Remove R)
  left  [ no With:left | BlockStub:aU:aD:aL:yR:color ] -> [ | BlockStub:aU:aD:aL:nR:color ]

endloop


[ BlockStub:yU:yD:yL:yR:color ] -> [ BlockUDLR_1:color ]

[ BlockStub:yU:yD:yL:nR:color ] -> [ BlockUDL_:color   ]
[ BlockStub:yU:yD:nL:yR:color ] -> [ BlockUD_R:color   ]
[ BlockStub:yU:nD:yL:yR:color ] -> [ BlockU_LR:color   ]
[ BlockStub:nU:yD:yL:yR:color ] -> [ Block_DLR:color   ]

[ BlockStub:yU:yD:nL:nR:color ] -> [ BlockUD__:color   ]
[ BlockStub:yU:nD:yL:nR:color ] -> [ BlockU_L__1:color ]
[ BlockStub:yU:nD:nL:yR:color ] -> [ BlockU__R_1:color ]
[ BlockStub:nU:yD:yL:nR:color ] -> [ Block_DL__1:color ]
[ BlockStub:nU:yD:nL:yR:color ] -> [ Block_D_R_1:color ]
[ BlockStub:nU:nD:yL:yR:color ] -> [ Block__LR:color   ]

[ BlockStub:yU:nD:nL:nR:color ] -> [ BlockU___:color ]
[ BlockStub:nU:yD:nL:nR:color ] -> [ Block_D__:color ]
[ BlockStub:nU:nD:yL:nR:color ] -> [ Block__L_:color ]
[ BlockStub:nU:nD:nL:yR:color ] -> [ Block___R:color ]

[ BlockStub:nU:nD:nL:nR:color ] -> [ Block____:color ]



[ moving MissingPlayer ] -> [ action MissingPlayer] Message You are dead. R = Restart. Z+Z = Undo.


(random [ action PlayerN ] -> [ PlayerN ]  win)


( This is mostly so that moving the direction keys doesn't change the state when the player
is dead and thus undo will work in one press )
[ ] -> [ PlayerNotFound ]
[ PlayerNotFound ][ SinkingPlayerSprite1 ] -> [][ SinkingPlayerSprite1 ]
[ PlayerNotFound ][ SinkingPlayerSprite2 ] -> [][ SinkingPlayerSprite2 ]
[ PlayerNotFound ][ SinkingPlayerSprite3 ] -> [][ SinkingPlayerSprite3 ]
[ PlayerNotFound ][ RealPlayer ] -> [][ RealPlayer ]
[ PlayerNotFound ][ action MissingPlayer ] -> [][ action MissingPlayer ]
[ PlayerNotFound  ] -> Cancel

[ action MissingPlayer ] -> [ ]

[ RealTimeTick ] -> []
[ stationary Player ] -> [ Player RealTimeTick ]


( some decorative stuff )
  [ HintTerminal2 DarkWall ] -> [ action DarkWall ]
  [ HintTerminal1          ] -> [ HintTerminal2 ]
  [ action DarkWall        ] -> [ HintTerminal1 DarkWall ]
  
  [RealTimeTick][ Shot1ParticleSprite2R ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot1ParticleSprite2L ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot1ParticleSprite2U ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot1ParticleSprite2D ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot2ParticleSprite2R ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot2ParticleSprite2L ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot2ParticleSprite2U ] ->  [RealTimeTick][  ]
  [RealTimeTick][ Shot2ParticleSprite2D ] ->  [RealTimeTick][  ]
  
  [RealTimeTick][ Shot1ParticleSprite1R ] ->  [RealTimeTick][ Shot1ParticleSprite2R ]
  [RealTimeTick][ Shot1ParticleSprite1L ] ->  [RealTimeTick][ Shot1ParticleSprite2L ]
  [RealTimeTick][ Shot1ParticleSprite1U ] ->  [RealTimeTick][ Shot1ParticleSprite2U ]
  [RealTimeTick][ Shot1ParticleSprite1D ] ->  [RealTimeTick][ Shot1ParticleSprite2D ]
  [RealTimeTick][ Shot2ParticleSprite1R ] ->  [RealTimeTick][ Shot2ParticleSprite2R ]
  [RealTimeTick][ Shot2ParticleSprite1L ] ->  [RealTimeTick][ Shot2ParticleSprite2L ]
  [RealTimeTick][ Shot2ParticleSprite1U ] ->  [RealTimeTick][ Shot2ParticleSprite2U ]
  [RealTimeTick][ Shot2ParticleSprite1D ] ->  [RealTimeTick][ Shot2ParticleSprite2D ]
  
( / some decorative stuff )

[ JustTurned ] -> []

( Instead of > replace it with a Want: towards the same direction )
[ > Player ] -> [ Want:>  stationary Player ]



( Turn the player if they are not alrady facing that direction)
directions weapon_status [ Want:directions Player:weapon_status     no Player:directions ] -> [ Player:weapon_status:directions     JustTurned ]

(Add Origin to the direction)
directions [ Player:directions Want:directions ] -> [ Player:directions Want:directions Origin:directions ]


(Move player after turning unless there was water or a white object next )
[ Background water no LightBridge ] -> [ water action Background ]
[ Player:> JustTurned | no WithWhite stationary Background ] -> [ Player:> Want:> Origin:> | Background ]
[ action Background ] -> [ Background ]


(..)
[ ConveyorLeft Block ] -> [ OriginL WantL Block ConveyorLeft ]

(If a disarmed player moves towards the portal gun, add the GotGun helper and play fx)
[ Player:disarmed:> Origin Want:> | PortalGunTM ] -> [ | Player:disarmed:front GotGun ] sfx1

(A disarmed player gets a portal gun, thus gains the blue property. Man I love PatternScript )
[ Player:disarmed GotGun ] -> [ Player:blue:front ] checkpoint message After aiming, press 'X' to shoot. You can change the color with a mouse click.

weapon_status [ Player:weapon_status:> | HintTerminal ] -> [ Player:weapon_status:< | HintTerminal ] sfx1 message You can switch portal colors by shooting at a portal of the same color. Or you can use a mouse click


(Cleanup light bridges)
[ LightBridge ] -> [ ]

(Prepare portal helpers)

(The portal exit is the cell a portal points to, it shares direction and color with the portal)
portal_color [ Portal:portal_color:> | No PortalExit:portal_color:> ] -> [ Portal:portal_color:> | PortalExit:portal_color:> ]

(In many rules we are just interested in knowing if there is an active portal facing a direction
at a certain cell, the rest doesn't mater as much, that's what ActivePortal: is for)
directions portal_color [ Portal:portal_color:directions  ][ Portal:toggle_portal_color] -> [ Portal:portal_color:directions   ActivePortal:directions ][ Portal:toggle_portal_color ]

( Do not consider a portal active if it is right next to a wall )
( This fixes situations in which you try to push a rigid body through a portal
 blocked by a wall, the rigid can disarm in that case)
(This part uses the action on wall to signify that active portals must be deleted)
[ ActivePortal:> | DarkOrWhiteWall ] -> [  | action DarkOrWhiteWall ]

[ action DarkOrWhiteWall ][ ActivePortal ] -> [ action DarkOrWhiteWall ][]
[ action DarkOrWhiteWall ] -> [ stationary DarkOrWhiteWall ]




( Detect rigids through portals )
[ ThroughPortal ] -> []

[ With:> | ActivePortal:< ] -> [ With:> ThroughPortal:> | ActivePortal:< ]


(For animation purposes, turn ShotF into Shot, this happens after 'again')
portal_color directions [ ShotF:portal_color:directions ] -> [ Shot:portal_color:directions ]


( Mouse Click Events )
[ MouseButton:horizontal ] -> [ ColorToggle ]


( Cancel shot if there are with:directions's through portals) 
[ ThroughPortal ][ action Player ] -> [ ThroughPortal ][ Player ] sfx9

( Shoot a portal )
portal_color directions [ action Player:portal_color:directions ] -> [ Player:portal_color:directions Shot:portal_color:directions ] sfx2

(Do not allow RealTime stuff when there's a shot visible)
[ BlueShot ][ RealTimeTick ] -> [ BlueShot ][ ]
[ OrangeShot ][ RealTimeTick ] -> [ OrangeShot ][ ]
([ BlueShot ][ Portal:blue ] -> [ BlueShot ][ ]
[ OrangeShot ][ Portal:orange ] -> [ OrangeShot ][ ])

[ BlueShot   ][ Portal1SPrite ] -> [ BlueShot ][ ]
[ OrangeShot ][ Portal2SPrite ] -> [ OrangeShot ][ ]

( Move the portal shot, but use the F sprite and schedule an again)
( It's a bit counter intuitive but we have to use > syntax here instead of the directions mapping )
portal_color [ Shot:portal_color:> | no WithCollision ] -> [ | ShotF:portal_color:> ] again


left  [Portal:blue][ Shot:blue:left  | WithWhite ] -> [][ Shot:blue:left  | WithWhite ]
right [Portal:blue][ Shot:blue:right | WithWhite ] -> [][ Shot:blue:right | WithWhite ]
down  [Portal:blue][ Shot:blue:down  | WithWhite ] -> [][ Shot:blue:down  | WithWhite ]
up    [Portal:blue][ Shot:blue:up    | WithWhite ] -> [][ Shot:blue:up    | WithWhite ]

left  [Portal:orange][ Shot:orange:left  | WithWhite ] -> [][ Shot:orange:left  | WithWhite ]
right [Portal:orange][ Shot:orange:right | WithWhite ] -> [][ Shot:orange:right | WithWhite ]
down  [Portal:orange][ Shot:orange:down  | WithWhite ] -> [][ Shot:orange:down  | WithWhite ]
up    [Portal:orange][ Shot:orange:up    | WithWhite ] -> [][ Shot:orange:up    | WithWhite ]


left  [ Shot:blue:left    | WithWhite ] -> [ ColorToggle | Portal:blue:right WithWhite ] sfx3
right [ Shot:blue:right   | WithWhite ] -> [ ColorToggle | Portal:blue:left WithWhite ] sfx3
up    [ Shot:blue:up      | WithWhite ] -> [ ColorToggle | Portal:blue:down WithWhite ] sfx3
down  [ Shot:blue:down    | WithWhite ] -> [ ColorToggle | Portal:blue:up WithWhite ] sfx3

left  [ Shot:orange:left  | WithWhite ] -> [ ColorToggle | Portal:orange:right WithWhite ] sfx3
right [ Shot:orange:right | WithWhite ] -> [ ColorToggle | Portal:orange:left WithWhite ] sfx3
up    [ Shot:orange:up    | WithWhite ] -> [ ColorToggle | Portal:orange:down WithWhite ] sfx3
down  [ Shot:orange:down  | WithWhite ] -> [ ColorToggle | Portal:orange:up WithWhite ] sfx3


( Prevent overlapping portals )
directions portal_color [ Portal:blue:directions  Portal:orange:directions  ][ Player:portal_color   ] -> [ Portal:portal_color:directions   ][ Player:portal_color   ]

(Draw portal shot sprite when it hits something that can't open a portal)
left  [ Shot:blue:left    | WithCollision ] -> [ | Shot1ParticleSprite1R WithCollision ]
right [ Shot:blue:right   | WithCollision ] -> [ | Shot1ParticleSprite1L WithCollision ]
up    [ Shot:blue:up      | WithCollision ] -> [ | Shot1ParticleSprite1D WithCollision ]
down  [ Shot:blue:down    | WithCollision ] -> [ | Shot1ParticleSprite1U WithCollision ]
left  [ Shot:orange:left  | WithCollision ] -> [ | Shot2ParticleSprite1R WithCollision ]
right [ Shot:orange:right | WithCollision ] -> [ | Shot2ParticleSprite1L WithCollision ]
up    [ Shot:orange:up    | WithCollision ] -> [ | Shot2ParticleSprite1D WithCollision ]
down  [ Shot:orange:down  | WithCollision ] -> [ | Shot2ParticleSprite1U WithCollision ]

(Toggle the portal gun's color)
portal_color player_face [ ColorToggle ][ Player:portal_color:player_face ] -> [ ][ Player:toggle_portal_color:player_face ]

[ RigidNextToPortal ] -> []

right [ Portal:blue:right   ActivePortal:right | With:left ] -> [  Portal:blue:right   ActivePortal:right | With:left RigidLNextToPortal ]
left  [ Portal:blue:left    ActivePortal:left  | With:right ] -> [  Portal:blue:left    ActivePortal:left  | With:right RigidRNextToPortal ]
up    [ Portal:blue:up      ActivePortal:up    | With:down ] -> [  Portal:blue:up      ActivePortal:up    | With:down RigidDNextToPortal ]
down  [ Portal:blue:down    ActivePortal:down  | With:up ] -> [  Portal:blue:down    ActivePortal:down  | With:up RigidUNextToPortal ]
right [ Portal:orange:right ActivePortal:right | With:left ] -> [  Portal:orange:right ActivePortal:right | With:left RigidLNextToPortal ]
left  [ Portal:orange:left  ActivePortal:left  | With:right ] -> [  Portal:orange:left  ActivePortal:left  | With:right RigidRNextToPortal ]
up    [ Portal:orange:up    ActivePortal:up    | With:down ] -> [  Portal:orange:up    ActivePortal:up    | With:down RigidDNextToPortal ]
down  [ Portal:orange:down  ActivePortal:down  | With:up ] -> [  Portal:orange:down  ActivePortal:down  | With:up RigidUNextToPortal ]



[ UnmovablePortal ] -> []
[ RigidNextToPortal ][ Portal:blue ] -> [ RigidNextToPortal ][ Portal:blue UnmovablePortal ]
[ RigidNextToPortal ][ Portal:orange ] -> [ RigidNextToPortal ][ Portal:orange UnmovablePortal ]


(  spread  )
startloop



  left  [ BlockPlayer WantL No ActivePortal:left  | Block No WantL No ActivePortal:right No UnmovablePortal ] -> [ BlockPlayer WantL | Block WantL ]
  right [ BlockPlayer WantR No ActivePortal:right | Block No WantR No ActivePortal:left  No UnmovablePortal ] -> [ BlockPlayer WantR | Block WantR ]
  down  [ BlockPlayer WantD No ActivePortal:down  | Block No WantD No ActivePortal:up    No UnmovablePortal ] -> [ BlockPlayer WantD | Block WantD ]
  up    [ BlockPlayer WantU No ActivePortal:up    | Block No WantU No ActivePortal:down  No UnmovablePortal ] -> [ BlockPlayer WantU | Block WantU ]


  left  [ WantL With:left | With:right no WantL ] -> [ WantL With:left | With:right WantL ]
  right [ WantL With:right | With:left no WantL ] -> [ WantL With:right | With:left WantL ]
  up    [ WantL With:up | With:down no WantL ] -> [ WantL With:up | With:down WantL ]
  down  [ WantL With:down | With:up no WantL ] -> [ WantL With:down | With:up WantL ]

  left  [ WantR With:left | With:right no WantR ] -> [ WantR With:left | With:right WantR ]
  right [ WantR With:right | With:left no WantR ] -> [ WantR With:right | With:left WantR ]
  up    [ WantR With:up | With:down no WantR ] -> [ WantR With:up | With:down WantR ]
  down  [ WantR With:down | With:up no WantR ] -> [ WantR With:down | With:up WantR ]

  left  [ WantU With:left | With:right no WantU ] -> [ WantU With:left | With:right WantU ]
  right [ WantU With:right | With:left no WantU ] -> [ WantU With:right | With:left WantU ]
  up    [ WantU With:up | With:down no WantU ] -> [ WantU With:up | With:down WantU ]
  down  [ WantU With:down | With:up no WantU ] -> [ WantU With:down | With:up WantU ]

  left  [ WantD With:left | With:right no WantD ] -> [ WantD With:left | With:right WantD ]
  right [ WantD With:right | With:left no WantD ] -> [ WantD With:right | With:left WantD ]
  up    [ WantD With:up | With:down no WantD ] -> [ WantD With:up | With:down WantD ]
  down  [ WantD With:down | With:up no WantD ] -> [ WantD With:down | With:up WantD ]



  ( Spread rigidity through portals )
  right [ Portal:blue:right| WantR With:left no RigidLeavingPortal1 ] -> [ Portal:blue:right UnmovablePortal | WantR With:left RigidLeavingPortal1 ]
  left  [ Portal:blue:left| WantL With:right no RigidLeavingPortal1 ] -> [ Portal:blue:left UnmovablePortal | WantL With:right RigidLeavingPortal1 ]
  up    [ Portal:blue:up| WantU With:down no RigidLeavingPortal1 ] -> [ Portal:blue:up UnmovablePortal | WantU With:down RigidLeavingPortal1 ]
  down  [ Portal:blue:down| WantD With:up no RigidLeavingPortal1 ] -> [ Portal:blue:down UnmovablePortal | WantD With:up RigidLeavingPortal1 ]
  right [ Portal:orange:right| WantR With:left no RigidLeavingPortal2 ] -> [ Portal:orange:right UnmovablePortal | WantR With:left RigidLeavingPortal2 ]
  left  [ Portal:orange:left| WantL With:right no RigidLeavingPortal2 ] -> [ Portal:orange:left UnmovablePortal | WantL With:right RigidLeavingPortal2 ]
  up    [ Portal:orange:up| WantU With:down no RigidLeavingPortal2 ] -> [ Portal:orange:up UnmovablePortal | WantU With:down RigidLeavingPortal2 ]
  down  [ Portal:orange:down| WantD With:up no RigidLeavingPortal2 ] -> [ Portal:orange:down UnmovablePortal | WantD With:up RigidLeavingPortal2 ]
  
  right [ Portal:blue:right| WantL With:left no RigidEnteringPortal1] -> [ Portal:blue:right UnmovablePortal | WantL With:left RigidEnteringPortal1]
  left  [ Portal:blue:left| WantR With:right no RigidEnteringPortal1] -> [ Portal:blue:left UnmovablePortal | WantR With:right RigidEnteringPortal1]
  up    [ Portal:blue:up| WantD With:down no RigidEnteringPortal1] -> [ Portal:blue:up UnmovablePortal | WantD With:down RigidEnteringPortal1]
  down  [ Portal:blue:down| WantU With:up no RigidEnteringPortal1] -> [ Portal:blue:down UnmovablePortal | WantU With:up RigidEnteringPortal1]
  right [ Portal:orange:right| WantL With:left no RigidEnteringPortal2] -> [ Portal:orange:right UnmovablePortal | WantL With:left RigidEnteringPortal2]
  left  [ Portal:orange:left| WantR With:right no RigidEnteringPortal2] -> [ Portal:orange:left UnmovablePortal | WantR With:right RigidEnteringPortal2]
  up    [ Portal:orange:up| WantD With:down no RigidEnteringPortal2] -> [ Portal:orange:up UnmovablePortal | WantD With:down RigidEnteringPortal2]
  down  [ Portal:orange:down| WantU With:up no RigidEnteringPortal2] -> [ Portal:orange:down UnmovablePortal | WantU With:up RigidEnteringPortal2]  
  
  right [ Portal:blue:right| With:left no WantR ][ RigidEnteringPortal2 ] -> [ Portal:blue:right UnmovablePortal | With:left WantR ][ RigidEnteringPortal2 ]
  left  [ Portal:blue:left| With:right no WantL ][ RigidEnteringPortal2 ] -> [ Portal:blue:left UnmovablePortal | With:right WantL ][ RigidEnteringPortal2 ]
  up    [ Portal:blue:up| With:down no WantU ][ RigidEnteringPortal2 ] -> [ Portal:blue:up UnmovablePortal | With:down WantU ][ RigidEnteringPortal2 ]
  down  [ Portal:blue:down| With:up no WantD ][ RigidEnteringPortal2 ] -> [ Portal:blue:down UnmovablePortal | With:up WantD ][ RigidEnteringPortal2 ]
  right [ Portal:orange:right| With:left no WantR ][ RigidEnteringPortal1 ] -> [ Portal:orange:right UnmovablePortal | With:left WantR ][ RigidEnteringPortal1 ]
  left  [ Portal:orange:left| With:right no WantL ][ RigidEnteringPortal1 ] -> [ Portal:orange:left UnmovablePortal | With:right WantL ][ RigidEnteringPortal1 ]
  up    [ Portal:orange:up| With:down no WantU ][ RigidEnteringPortal1 ] -> [ Portal:orange:up UnmovablePortal | With:down WantU ][ RigidEnteringPortal1 ]
  down  [ Portal:orange:down| With:up no WantD ][ RigidEnteringPortal1 ] -> [ Portal:orange:down UnmovablePortal | With:up WantD ][ RigidEnteringPortal1 ]

  right [ Portal:blue:right| With:left no WantL ][ RigidLeavingPortal2  ] -> [ Portal:blue:right UnmovablePortal | With:left WantL ][ RigidLeavingPortal2  ]
  left  [ Portal:blue:left| With:right no WantR ][ RigidLeavingPortal2  ] -> [ Portal:blue:left UnmovablePortal | With:right WantR ][ RigidLeavingPortal2  ]
  up    [ Portal:blue:up| With:down no WantD ][ RigidLeavingPortal2  ] -> [ Portal:blue:up UnmovablePortal | With:down WantD ][ RigidLeavingPortal2  ]
  down  [ Portal:blue:down| With:up no WantU ][ RigidLeavingPortal2  ] -> [ Portal:blue:down UnmovablePortal | With:up WantU ][ RigidLeavingPortal2  ]
  right [ Portal:orange:right| With:left no WantL ][ RigidLeavingPortal1  ] -> [ Portal:orange:right UnmovablePortal | With:left WantL ][ RigidLeavingPortal1  ]
  left  [ Portal:orange:left| With:right no WantR ][ RigidLeavingPortal1  ] -> [ Portal:orange:left UnmovablePortal | With:right WantR ][ RigidLeavingPortal1  ]
  up    [ Portal:orange:up| With:down no WantD ][ RigidLeavingPortal1  ] -> [ Portal:orange:up UnmovablePortal | With:down WantD ][ RigidLeavingPortal1  ]
  down  [ Portal:orange:down| With:up no WantU ][ RigidLeavingPortal1  ] -> [ Portal:orange:down UnmovablePortal | With:up WantU ][ RigidLeavingPortal1  ]
  
  ( BlockPlayer pushing through portal )
  right [ Portal:blue:right ActivePortal:right | BlockPlayer WantL no BPEnteringPortal1 no With:up no With:down ] -> [ Portal:blue:right ActivePortal:right UnmovablePortal | BlockPlayer WantL BPEnteringPortal1 ]
  left  [ Portal:blue:left ActivePortal:left  | BlockPlayer WantR no BPEnteringPortal1 no With:up no With:down ] -> [ Portal:blue:left ActivePortal:left  UnmovablePortal | BlockPlayer WantR BPEnteringPortal1 ]
  up    [ Portal:blue:up ActivePortal:up    | BlockPlayer WantD no BPEnteringPortal1 no With:right no With:left ] -> [ Portal:blue:up ActivePortal:up    UnmovablePortal | BlockPlayer WantD BPEnteringPortal1 ]
  down  [ Portal:blue:down ActivePortal:down  | BlockPlayer WantU no BPEnteringPortal1 no With:right no With:left ] -> [ Portal:blue:down ActivePortal:down  UnmovablePortal | BlockPlayer WantU BPEnteringPortal1 ]
  right [ Portal:orange:right ActivePortal:right | BlockPlayer WantL no BPEnteringPortal2 no With:up no With:down ] -> [ Portal:orange:right ActivePortal:right UnmovablePortal | BlockPlayer WantL BPEnteringPortal2 ]
  left  [ Portal:orange:left ActivePortal:left  | BlockPlayer WantR no BPEnteringPortal2 no With:up no With:down ] -> [ Portal:orange:left ActivePortal:left  UnmovablePortal | BlockPlayer WantR BPEnteringPortal2 ]
  up    [ Portal:orange:up ActivePortal:up    | BlockPlayer WantD no BPEnteringPortal2 no With:right no With:left ] -> [ Portal:orange:up ActivePortal:up    UnmovablePortal | BlockPlayer WantD BPEnteringPortal2 ]
  down  [ Portal:orange:down ActivePortal:down  | BlockPlayer WantU no BPEnteringPortal2 no With:right no With:left ] -> [ Portal:orange:down ActivePortal:down  UnmovablePortal | BlockPlayer WantU BPEnteringPortal2 ]
  
  right [ Portal:blue:right| BlockPlayer No WantR ][ BPEnteringPortal2 ] -> [ Portal:blue:right UnmovablePortal | BlockPlayer WantR ][ BPEnteringPortal2 ]
  left  [ Portal:blue:left| BlockPlayer No WantL ][ BPEnteringPortal2 ] -> [ Portal:blue:left UnmovablePortal | BlockPlayer WantL ][ BPEnteringPortal2 ]
  up    [ Portal:blue:up| BlockPlayer No WantU ][ BPEnteringPortal2 ] -> [ Portal:blue:up UnmovablePortal | BlockPlayer WantU ][ BPEnteringPortal2 ]
  down  [ Portal:blue:down| BlockPlayer No WantD ][ BPEnteringPortal2 ] -> [ Portal:blue:down UnmovablePortal | BlockPlayer WantD ][ BPEnteringPortal2 ]
  right [ Portal:orange:right| BlockPlayer No WantR ][ BPEnteringPortal1 ] -> [ Portal:orange:right UnmovablePortal | BlockPlayer WantR ][ BPEnteringPortal1 ]
  left  [ Portal:orange:left| BlockPlayer No WantL ][ BPEnteringPortal1 ] -> [ Portal:orange:left UnmovablePortal | BlockPlayer WantL ][ BPEnteringPortal1 ]
  up    [ Portal:orange:up| BlockPlayer No WantU ][ BPEnteringPortal1 ] -> [ Portal:orange:up UnmovablePortal | BlockPlayer WantU ][ BPEnteringPortal1 ]
  down  [ Portal:orange:down| BlockPlayer No WantD ][ BPEnteringPortal1 ] -> [ Portal:orange:down UnmovablePortal | BlockPlayer WantD ][ BPEnteringPortal1 ]

  [ Portal:blue    UnmovablePortal ][ Portal:orange No UnmovablePortal ] -> [ Portal:blue UnmovablePortal ][ Portal:orange UnmovablePortal ]
  [ Portal:blue No UnmovablePortal ][ Portal:orange    UnmovablePortal ] -> [ Portal:blue UnmovablePortal ][ Portal:orange UnmovablePortal ]

endloop

(  detect error )



[ FutureUsed ] -> []
( detect objects moving to the same place )
right [ WantR no BPEnteringPortal1 no BPEnteringPortal2 | FutureUsed ] -> [ WantR | FutureUsed Error ]
right [ WantR no BPEnteringPortal1 no BPEnteringPortal2 |            ] -> [       WantR | FutureUsed ]

left  [ WantL no BPEnteringPortal1 no BPEnteringPortal2 | FutureUsed ] -> [ WantL | FutureUsed Error ]
left  [ WantL no BPEnteringPortal1 no BPEnteringPortal2 |            ] -> [       WantL | FutureUsed ]

up    [ WantU no BPEnteringPortal1 no BPEnteringPortal2 | FutureUsed ] -> [ WantU | FutureUsed Error ]
up    [ WantU no BPEnteringPortal1 no BPEnteringPortal2 |            ] -> [       WantU | FutureUsed ]

down  [ WantD no BPEnteringPortal1 no BPEnteringPortal2 | FutureUsed ] -> [  WantD | FutureUsed Error ]
down  [ WantD no BPEnteringPortal1 no BPEnteringPortal2 |            ] -> [       WantD | FutureUsed ]


right [ WantR BPEnteringPortal1 ][ PortalExit:orange FutureUsed ] -> [ Error WantR BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
right [ WantR BPEnteringPortal1 ][ PortalExit:orange            ] -> [       WantR BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
right [ WantR BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ] -> [ Error WantR BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]
right [ WantR BPEnteringPortal2 ][ PortalExit:blue              ] -> [       WantR BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]

left  [ WantL BPEnteringPortal1 ][ PortalExit:orange FutureUsed ] -> [ Error WantL BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
left  [ WantL BPEnteringPortal1 ][ PortalExit:orange            ] -> [       WantL BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
left  [ WantL BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ] -> [ Error WantL BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]
left  [ WantL BPEnteringPortal2 ][ PortalExit:blue              ] -> [       WantL BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]

up    [ WantU BPEnteringPortal1 ][ PortalExit:orange FutureUsed ] -> [ Error WantU BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
up    [ WantU BPEnteringPortal1 ][ PortalExit:orange            ] -> [       WantU BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
up    [ WantU BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ] -> [ Error WantU BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]
up    [ WantU BPEnteringPortal2 ][ PortalExit:blue              ] -> [       WantU BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]

down  [ WantD BPEnteringPortal1 ][ PortalExit:orange FutureUsed ] -> [ Error WantD BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
down  [ WantD BPEnteringPortal1 ][ PortalExit:orange            ] -> [       WantD BPEnteringPortal1 ][ PortalExit:orange FutureUsed ]
down  [ WantD BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ] -> [ Error WantD BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]
down  [ WantD BPEnteringPortal2 ][ PortalExit:blue              ] -> [       WantD BPEnteringPortal2 ][ PortalExit:blue   FutureUsed ]

( /detect objects moving to the same place )



startloop
  [ BPEnteringPortal1 ][ Portal:blue ] -> [ BPEnteringPortal1 ][ UnmovablePortal Portal:blue ]
  [ BPEnteringPortal2 ][ Portal:orange ] -> [ BPEnteringPortal2 ][ UnmovablePortal Portal:orange ]

  (   hit something then add error)
  left  [ WantL No Error | WithCollision no WantL no ActivePortal:right ] -> [ WantL Error PostError | WithCollision ]
  right [ WantR No Error | WithCollision no WantR no ActivePortal:left  ] -> [ WantR Error PostError | WithCollision ]
  down  [ WantD No Error | WithCollision no WantD no ActivePortal:up    ] -> [ WantD Error PostError | WithCollision ]
  up    [ WantU No Error | WithCollision no WantU no ActivePortal:down  ] -> [ WantU Error PostError | WithCollision ]


  left  [ WantL No Error UnmovablePortal ] -> [ WantL Error PostError UnmovablePortal ]
  right [ WantR No Error UnmovablePortal ] -> [ WantR Error PostError UnmovablePortal ]
  down  [ WantD No Error UnmovablePortal ] -> [ WantD Error PostError UnmovablePortal ]
  up    [ WantU No Error UnmovablePortal ] -> [ WantU Error PostError UnmovablePortal ]


  ( Attempt to push rigid through portal )

  (left [ wantL No Error WithVertical   | ActivePortal:right ] -> [ wantL Error WithVertical   | ActivePortal:right ]
  right[ wantR No Error WithVertical   | ActivePortal:left  ] -> [ wantR Error WithVertical   | ActivePortal:left ]
  down [ wantD No Error WithHorizontal | ActivePortal:up    ] -> [ wantD Error WithHorizontal | ActivePortal:up ]
  up   [ wantU No Error WithHorizontal | ActivePortal:down  ] -> [ wantU Error WithHorizontal | ActivePortal:down ])

  ( Cant cut )
  [ WantH RigidUNextToPortal ] -> [ WantH RigidUNextToPortal Error ]
  [ WantH RigidDNextToPortal ] -> [ WantH RigidDNextToPortal Error ]
  [ WantV RigidRNextToPortal ] -> [ WantV RigidRNextToPortal Error ]
  [ WantV RigidLNextToPortal ] -> [ WantV RigidLNextToPortal Error ]
  
  right [ ActivePortal:right | WantL WithVertical ] -> [ ActivePortal:right | WantL WithVertical Error ] 
  left  [ ActivePortal:left  | WantR WithVertical ] -> [ ActivePortal:left  | WantR WithVertical Error ] 
  up    [ ActivePortal:up    | WantD WithHorizontal]-> [ ActivePortal:up    | WantD WithHorizontal Error ] 
  down  [ ActivePortal:down  | WantU WithHorizontal]-> [ ActivePortal:down  | WantU WithHorizontal Error ] 




  ( Cant push and cut )
  [ Want Portal:blue No Error ][ RigidNextToPortal ] -> [ Want Portal:blue Error ][ RigidNextToPortal ] 
  [ Want Portal:orange No Error ][ RigidNextToPortal ] -> [ Want Portal:orange Error ][ RigidNextToPortal ] 
  
  ( Contradiction, then add error )
  [ WantL WantNotL ] -> [ WantL WantNotL Error ]
  [ WantR WantNotR ] -> [ WantR WantNotR Error ]
  [ WantD WantNotD ] -> [ WantD WantNotD Error ]
  [ WantU WantNotU ] -> [ WantU WantNotU Error ]

  (   hit error , then add error)
  left [ WantL No Error | WithCollision Error ] -> [ WantL Error PostError | WithCollision Error ]
  right [ WantR No Error | WithCollision Error ] -> [ WantR Error PostError | WithCollision Error ]
  down [ WantD No Error | WithCollision Error ] -> [ WantD Error PostError | WithCollision Error ]
  up [ WantU No Error | WithCollision Error ] -> [ WantU Error PostError | WithCollision Error ]


  (   player attempting to push error, then add error)
  left [ BlockPlayer WantL no Error | Block WantL Error ] -> [  BlockPlayer WantL Error | Block WantL Error ]
  right [  BlockPlayer WantR no Error | Block WantR Error ] -> [  BlockPlayer WantR Error | Block WantR Error ]
  down [  BlockPlayer WantD no Error | Block WantD Error ] -> [  BlockPlayer WantD Error | Block WantD Error ]
  up [  BlockPlayer WantU no Error | Block WantU Error ] -> [  BlockPlayer WantU Error | Block WantU Error ]


  (   contiguous to error, then add error)
  left  [ Want With:left Error | With:right Want no Error ] -> [ Want With:left Error | With:right Want Error ]
  right  [ Want With:right Error | With:left Want no Error ] -> [ Want With:right Error | With:left Want Error ]
  down  [ Want With:down Error | With:up Want no Error ] -> [ Want With:down Error | With:up Want Error ]
  up  [ Want With:up Error | With:down Want no Error ] -> [ Want With:up Error | With:down Want Error ]

  ( Portal attempting to enter another portal )
  right [ Portal:blue wantR | Portal:orange:left] -> [ Portal:blue wantR Error | Portal:orange:left]
  left  [ Portal:blue wantL | Portal:orange:right] -> [ Portal:blue wantL Error | Portal:orange:right]
  up    [ Portal:blue wantU | Portal:orange:down] -> [ Portal:blue wantU Error | Portal:orange:down]
  down  [ Portal:blue wantD | Portal:orange:up] -> [ Portal:blue wantD Error | Portal:orange:up]
  right [ Portal:orange wantR | Portal:blue:left] -> [ Portal:orange wantR Error | Portal:blue:left]
  left  [ Portal:orange wantL | Portal:blue:right] -> [ Portal:orange wantL Error | Portal:blue:right]
  up    [ Portal:orange wantU | Portal:blue:down] -> [ Portal:orange wantU Error | Portal:blue:down]
  down  [ Portal:orange wantD | Portal:blue:up] -> [ Portal:orange wantD Error | Portal:blue:up]


  ( > spread errors through portals )
  right [ Portal:blue:right| BlockPlayer WantR no BPLeavingPortal1 ] -> [ Portal:blue:right| BlockPlayer WantR BPLeavingPortal1 ]
  left  [ Portal:blue:left| BlockPlayer WantL no BPLeavingPortal1 ] -> [ Portal:blue:left| BlockPlayer WantL BPLeavingPortal1 ]
  up    [ Portal:blue:up| BlockPlayer WantU no BPLeavingPortal1 ] -> [ Portal:blue:up| BlockPlayer WantU BPLeavingPortal1 ]
  down  [ Portal:blue:down| BlockPlayer WantD no BPLeavingPortal1 ] -> [ Portal:blue:down| BlockPlayer WantD BPLeavingPortal1 ]
  right [ Portal:orange:right| BlockPlayer WantR no BPLeavingPortal2 ] -> [ Portal:orange:right| BlockPlayer WantR BPLeavingPortal2 ]
  left  [ Portal:orange:left| BlockPlayer WantL no BPLeavingPortal2 ] -> [ Portal:orange:left| BlockPlayer WantL BPLeavingPortal2 ]
  up    [ Portal:orange:up| BlockPlayer WantU no BPLeavingPortal2 ] -> [ Portal:orange:up| BlockPlayer WantU BPLeavingPortal2 ]
  down  [ Portal:orange:down| BlockPlayer WantD no BPLeavingPortal2 ] -> [ Portal:orange:down| BlockPlayer WantD BPLeavingPortal2 ]
  
  [ BPEnteringPortal1 no Error ][ BPLeavingPortal2 Error ] -> [ BPEnteringPortal1 Error ][ BPLeavingPortal2 Error ]
  [ BPEnteringPortal2 no Error ][ BPLeavingPortal1 Error ] -> [ BPEnteringPortal2 Error ][ BPLeavingPortal1 Error ]
  

endloop




( Remove wants)
[ Want ] -> [  ]

( Spread Wants again , but this time can't spread through errors)

[ OriginL no Error ] -> [WantL]
[ OriginR no Error ] -> [WantR]
[ OriginD no Error ] -> [WantD]
[ OriginU no Error ] -> [WantU]


[ Origin ] -> []

[ RigidEnteringPortal1 ] -> []
[ RigidEnteringPortal2 ] -> []
[ RigidLeavingPortal1 ] -> []
[ RigidLeavingPortal2 ] -> []
[ BPEnteringPortal1 ] -> []
[ BPEnteringPortal2 ] -> []
[ BPLeavingPortal1 ] -> []
[ BPLeavingPortal2 ] -> []



(  spread again, blocked by errors )


startloop
  left  [ BlockPlayer WantL No BPEnteringPortal1 No BPEnteringPortal2 | Block No WantL No Error No UnmovablePortal No ActivePortal:right ] -> [ BlockPlayer WantL | Block WantL ]
  right [ BlockPlayer WantR No BPEnteringPortal1 No BPEnteringPortal2 | Block No WantR No Error No UnmovablePortal No ActivePortal:left ] -> [ BlockPlayer WantR | Block WantR ]
  down  [ BlockPlayer WantD No BPEnteringPortal1 No BPEnteringPortal2 | Block No WantD no Error No UnmovablePortal No ActivePortal:up ] -> [ BlockPlayer WantD | Block WantD ]
  up    [ BlockPlayer WantU No BPEnteringPortal1 No BPEnteringPortal2 | Block No WantU no Error No UnmovablePortal No ActivePortal:down ] -> [ BlockPlayer WantU | Block WantU ]



  left  [ Want With:left | With:right no Want no Error ] -> [ Want With:left | With:right Want ]
  right  [ Want With:right | With:left no Want no Error ] -> [ Want With:right | With:left Want ]
  up  [ Want With:up | With:down no Want no Error ] -> [ Want With:up | With:down Want ]
  down  [ Want With:down | With:up no Want no Error ] -> [ Want With:down | With:up Want ]
 
  ( Spread rigidity through portals minus error )
  right [ Portal:blue:right| WantR With:left no RigidLeavingPortal1  ] -> [ Portal:blue:right| WantR With:left RigidLeavingPortal1 ]
  left  [ Portal:blue:left| WantL With:right no RigidLeavingPortal1 ] -> [ Portal:blue:left| WantL With:right RigidLeavingPortal1 ]
  up    [ Portal:blue:up| WantU With:down no RigidLeavingPortal1 ] -> [ Portal:blue:up| WantU With:down RigidLeavingPortal1 ]
  down  [ Portal:blue:down| WantD With:up no RigidLeavingPortal1 ] -> [ Portal:blue:down| WantD With:up RigidLeavingPortal1 ]
  right [ Portal:orange:right| WantR With:left no RigidLeavingPortal2   ] -> [ Portal:orange:right| WantR With:left RigidLeavingPortal2 ]
  left  [ Portal:orange:left| WantL With:right no RigidLeavingPortal2   ] -> [ Portal:orange:left| WantL With:right RigidLeavingPortal2 ]
  up    [ Portal:orange:up| WantU With:down no RigidLeavingPortal2 ] -> [ Portal:orange:up| WantU With:down RigidLeavingPortal2 ]
  down  [ Portal:orange:down| WantD With:up no RigidLeavingPortal2 ] -> [ Portal:orange:down| WantD With:up RigidLeavingPortal2 ]
  
  right [ Portal:blue:right| WantL With:left no RigidEnteringPortal1 no WithVertical  ] -> [ Portal:blue:right| WantL With:left RigidEnteringPortal1]
  left  [ Portal:blue:left| WantR With:right no RigidEnteringPortal1 no WithVertical  ] -> [ Portal:blue:left| WantR With:right RigidEnteringPortal1]
  up    [ Portal:blue:up| WantD With:down no RigidEnteringPortal1 no WithHorizontal] -> [ Portal:blue:up| WantD With:down RigidEnteringPortal1]
  down  [ Portal:blue:down| WantU With:up no RigidEnteringPortal1 no WithHorizontal] -> [ Portal:blue:down| WantU With:up RigidEnteringPortal1]
  right [ Portal:orange:right| WantL With:left no RigidEnteringPortal2 no WithVertical  ] -> [ Portal:orange:right| WantL With:left RigidEnteringPortal2]
  left  [ Portal:orange:left| WantR With:right no RigidEnteringPortal2 no WithVertical  ] -> [ Portal:orange:left| WantR With:right RigidEnteringPortal2]
  up    [ Portal:orange:up| WantD With:down no RigidEnteringPortal2 no WithHorizontal] -> [ Portal:orange:up| WantD With:down RigidEnteringPortal2]
  down  [ Portal:orange:down| WantU With:up no RigidEnteringPortal2 no WithHorizontal] -> [ Portal:orange:down| WantU With:up RigidEnteringPortal2]  
  
  right [ Portal:blue:right| With:left no WantR no Error ][ RigidEnteringPortal2 ] -> [ Portal:blue:right| With:left WantR ][ RigidEnteringPortal2 ]
  left  [ Portal:blue:left| With:right no WantL no Error ][ RigidEnteringPortal2 ] -> [ Portal:blue:left| With:right WantL ][ RigidEnteringPortal2 ]
  up    [ Portal:blue:up| With:down no WantU no Error ][ RigidEnteringPortal2 ] -> [ Portal:blue:up| With:down WantU ][ RigidEnteringPortal2 ]
  down  [ Portal:blue:down| With:up no WantD no Error ][ RigidEnteringPortal2 ] -> [ Portal:blue:down| With:up WantD ][ RigidEnteringPortal2 ]
  right [ Portal:orange:right| With:left no WantR no Error ][ RigidEnteringPortal1 ] -> [ Portal:orange:right| With:left WantR ][ RigidEnteringPortal1 ]
  left  [ Portal:orange:left| With:right no WantL no Error ][ RigidEnteringPortal1 ] -> [ Portal:orange:left| With:right WantL ][ RigidEnteringPortal1 ]
  up    [ Portal:orange:up| With:down no WantU no Error ][ RigidEnteringPortal1 ] -> [ Portal:orange:up| With:down WantU ][ RigidEnteringPortal1 ]
  down  [ Portal:orange:down| With:up no WantD no Error ][ RigidEnteringPortal1 ] -> [ Portal:orange:down| With:up WantD ][ RigidEnteringPortal1 ]

  right [ Portal:blue:right| With:left no WantL no Error ][ RigidLeavingPortal2  ] -> [ Portal:blue:right| With:left WantL ][ RigidLeavingPortal2  ]
  left  [ Portal:blue:left| With:right no WantR no Error ][ RigidLeavingPortal2  ] -> [ Portal:blue:left| With:right WantR ][ RigidLeavingPortal2  ]
  up    [ Portal:blue:up| With:down no WantD no Error ][ RigidLeavingPortal2  ] -> [ Portal:blue:up| With:down WantD ][ RigidLeavingPortal2  ]
  down  [ Portal:blue:down| With:up no WantU no Error ][ RigidLeavingPortal2  ] -> [ Portal:blue:down| With:up WantU ][ RigidLeavingPortal2  ]
  right [ Portal:orange:right| With:left no WantL no Error ][ RigidLeavingPortal1  ] -> [ Portal:orange:right| With:left WantL ][ RigidLeavingPortal1  ]
  left  [ Portal:orange:left| With:right no WantR no Error ][ RigidLeavingPortal1  ] -> [ Portal:orange:left| With:right WantR ][ RigidLeavingPortal1  ]
  up    [ Portal:orange:up| With:down no WantD no Error ][ RigidLeavingPortal1  ] -> [ Portal:orange:up| With:down WantD ][ RigidLeavingPortal1  ]
  down  [ Portal:orange:down| With:up no WantU no Error ][ RigidLeavingPortal1  ] -> [ Portal:orange:down| With:up WantU ][ RigidLeavingPortal1  ]
  
  ( BlockPlayer pushing through portal, no error )
  right [ Portal:blue:right| BlockPlayer WantL no BPEnteringPortal1 no WithVertical   ] -> [ Portal:blue:right| BlockPlayer WantL BPEnteringPortal1 ]
  left  [ Portal:blue:left| BlockPlayer WantR no BPEnteringPortal1 no WithVertical   ] -> [ Portal:blue:left| BlockPlayer WantR BPEnteringPortal1 ]
  up    [ Portal:blue:up| BlockPlayer WantD no BPEnteringPortal1 no WithHorizontal ] -> [ Portal:blue:up| BlockPlayer WantD BPEnteringPortal1 ]
  down  [ Portal:blue:down| BlockPlayer WantU no BPEnteringPortal1 no WithHorizontal ] -> [ Portal:blue:down| BlockPlayer WantU BPEnteringPortal1 ]
  right [ Portal:orange:right| BlockPlayer WantL no BPEnteringPortal2 no WithVertical   ] -> [ Portal:orange:right| BlockPlayer WantL BPEnteringPortal2 ]
  left  [ Portal:orange:left| BlockPlayer WantR no BPEnteringPortal2 no WithVertical   ] -> [ Portal:orange:left| BlockPlayer WantR BPEnteringPortal2 ]
  up    [ Portal:orange:up| BlockPlayer WantD no BPEnteringPortal2 no WithHorizontal ] -> [ Portal:orange:up| BlockPlayer WantD BPEnteringPortal2 ]
  down  [ Portal:orange:down| BlockPlayer WantU no BPEnteringPortal2 no WithHorizontal ] -> [ Portal:orange:down| BlockPlayer WantU BPEnteringPortal2 ]
  
  right [ Portal:blue:right| BlockPlayer No WantR no Error ][ BPEnteringPortal2 ] -> [ Portal:blue:right| BlockPlayer WantR ][ BPEnteringPortal2 ]
  left  [ Portal:blue:left| BlockPlayer No WantL no Error ][ BPEnteringPortal2 ] -> [ Portal:blue:left| BlockPlayer WantL ][ BPEnteringPortal2 ]
  up    [ Portal:blue:up| BlockPlayer No WantU no Error ][ BPEnteringPortal2 ] -> [ Portal:blue:up| BlockPlayer WantU ][ BPEnteringPortal2 ]
  down  [ Portal:blue:down| BlockPlayer No WantD no Error ][ BPEnteringPortal2 ] -> [ Portal:blue:down| BlockPlayer WantD ][ BPEnteringPortal2 ]
  right [ Portal:orange:right| BlockPlayer No WantR no Error ][ BPEnteringPortal1 ] -> [ Portal:orange:right| BlockPlayer WantR ][ BPEnteringPortal1 ]
  left  [ Portal:orange:left| BlockPlayer No WantL no Error ][ BPEnteringPortal1 ] -> [ Portal:orange:left| BlockPlayer WantL ][ BPEnteringPortal1 ]
  up    [ Portal:orange:up| BlockPlayer No WantU no Error ][ BPEnteringPortal1 ] -> [ Portal:orange:up| BlockPlayer WantU ][ BPEnteringPortal1 ]
  down  [ Portal:orange:down| BlockPlayer No WantD no Error ][ BPEnteringPortal1 ] -> [ Portal:orange:down| BlockPlayer WantD ][ BPEnteringPortal1 ]



endloop




( perform the move )
[ no Portal:blue ] -> [ NoPortal1 ]
[ no Portal:orange ] -> [ NoPortal2 ]

[ Block Want ] -> sfx8


( detect up cycles , with the help of an empty spot we can solve them )
[ Pointer ] -> []
[ EmptySpot ] -> []
[ PointerEnd ] -> []
up [ Portal:up | WantU ] -> [ Portal:up | Pointer WantU ]
startloop
  up [ Pointer | Portal:down ] -> [ Pointer PointerEnd | Portal:down ]
  up [ Pointer | WantU no Pointer no Portal:down ] -> [ Pointer | WantU Pointer ]
endloop

[ PointerEnd WithCollision WantU ][ No WithCollision ] -> [ ][ EmptySpot WithCollision ] sfx4
up [ Pointer WantU WithCollision | no WithCollision ][ EmptySpot ] -> [  | WithCollision ][ EmptySpot ]
up [ Portal:up | ][ EmptySpot WithCollision ] -> [ Portal:up | WithCollision ][]
( /detect up cycles)

( detect down cycles , with the help of an empty spot we can solve them )
[ Pointer ] -> []
[ EmptySpot ] -> []
[ PointerEnd ] -> []
down [ Portal:down | WantD ] -> [ Portal:down | Pointer WantD ]
startloop
  down [ Pointer | Portal:up ] -> [ Pointer PointerEnd | Portal:up ]
  down [ Pointer | WantD no Pointer no Portal:up ] -> [ Pointer | WantD Pointer ]
endloop

[ PointerEnd WithCollision WantD ][ No WithCollision ] -> [ ][ EmptySpot WithCollision ] sfx4
down [ Pointer WantD WithCollision | no WithCollision ][ EmptySpot ] -> [  | WithCollision ][ EmptySpot ]
down [ Portal:down | ][ EmptySpot WithCollision ] -> [ Portal:down | WithCollision ][]
( /detect down cycles)

( detect left cycles , with the help of an empty spot we can solve them )
[ Pointer ] -> []
[ EmptySpot ] -> []
[ PointerEnd ] -> []
left [ Portal:left | WantL ] -> [ Portal:left | Pointer WantL ]
startloop
  left [ Pointer | Portal:right ] -> [ Pointer PointerEnd | Portal:right ]
  left [ Pointer | WantL no Pointer no Portal:right ] -> [ Pointer | WantL Pointer ]
endloop

[ PointerEnd WithCollision WantL ][ No WithCollision ] -> [ ][ EmptySpot WithCollision ] sfx4
left [ Pointer WantL WithCollision | no WithCollision ][ EmptySpot ] -> [  | WithCollision ][ EmptySpot ]
left [ Portal:left | ][ EmptySpot WithCollision ] -> [ Portal:left | WithCollision ][]
( /detect left cycles)

( detect right cycles , with the help of an empty spot we can solve them )
[ Pointer ] -> []
[ EmptySpot ] -> []
[ PointerEnd ] -> []
right [ Portal:right | WantR ] -> [ Portal:right | Pointer WantR ]
startloop
  right [ Pointer | Portal:left ] -> [ Pointer PointerEnd | Portal:left ]
  right [ Pointer | WantR no Pointer no Portal:left ] -> [ Pointer | WantR Pointer ]
endloop

[ PointerEnd WithCollision WantR ][ No WithCollision ] -> [ ][ EmptySpot WithCollision ] sfx4
right [ Pointer WantR WithCollision | no WithCollision ][ EmptySpot ] -> [  | WithCollision ][ EmptySpot ]
right [ Portal:right | ][ EmptySpot WithCollision ] -> [ Portal:right | WithCollision ][]
( /detect right cycles)
[ Pointer ] -> []
[ EmptySpot ] -> []
[ PointerEnd ] -> []



startloop


  (Move with or without portal )
  left  [ WantL BlockPlayer Portal1OrNothing Portal2OrNothing | No WithCollision No WantL ] -> [ | BlockPlayer Portal1OrNothing Portal2OrNothing ]
  right [ WantR BlockPlayer Portal1OrNothing Portal2OrNothing | No WithCollision No WantR ] -> [ | BlockPlayer Portal1OrNothing Portal2OrNothing ]
  up    [ WantU BlockPlayer Portal1OrNothing Portal2OrNothing | No WithCollision No WantU ] -> [ | BlockPlayer Portal1OrNothing Portal2OrNothing ]
  down  [ WantD BlockPlayer Portal1OrNothing Portal2OrNothing | No WithCollision No WantD ] -> [ | BlockPlayer Portal1OrNothing Portal2OrNothing ]
 
 
  (Teleportation! )    
  (1RR)
  right [ Portal:blue:right| WantL BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:right No WithCollision No WantR ] -> [ Portal:blue:right| ][ PortalExit:orange:right BlockPlayer RotateRR ]
  (1RL)
  right [ Portal:blue:right| WantL BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:left No WithCollision No WantL ] -> [ Portal:blue:right| ][ PortalExit:orange:left BlockPlayer RotateRL ]
  (1RU)
  right [ Portal:blue:right| WantL BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:up No WithCollision No WantU ] -> [ Portal:blue:right| ][ PortalExit:orange:up BlockPlayer RotateRU ]
  (1RD)
  right [ Portal:blue:right| WantL BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:down No WithCollision No WantD ] -> [ Portal:blue:right| ][ PortalExit:orange:down BlockPlayer RotateRD ]

  (1LR)
  left  [ Portal:blue:left| WantR BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:right No WithCollision No WantR ] -> [ Portal:blue:left| ][ PortalExit:orange:right BlockPlayer RotateLR ]
  (1LL)
  left  [ Portal:blue:left| WantR BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:left No WithCollision No WantL ] -> [ Portal:blue:left| ][ PortalExit:orange:left BlockPlayer RotateLL ]
  (1LU)
  left  [ Portal:blue:left| WantR BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:up No WithCollision No WantU ] -> [ Portal:blue:left| ][ PortalExit:orange:up BlockPlayer RotateLU ]
  (1LD)
  left  [ Portal:blue:left| WantR BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:down No WithCollision No WantD ] -> [ Portal:blue:left| ][ PortalExit:orange:down BlockPlayer RotateLD ]

  (1UR)
  up    [ Portal:blue:up| WantD BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:right No WithCollision No WantR ] -> [ Portal:blue:up| ][ PortalExit:orange:right BlockPlayer RotateUR ]
  (1UL)
  up    [ Portal:blue:up| WantD BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:left No WithCollision No WantL ] -> [ Portal:blue:up| ][ PortalExit:orange:left BlockPlayer RotateUL ]
  (1UU)
  up    [ Portal:blue:up| WantD BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:up No WithCollision No WantU ] -> [ Portal:blue:up| ][ PortalExit:orange:up BlockPlayer RotateUU ]
  (1UD)
  up    [ Portal:blue:up| WantD BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:down No WithCollision No WantD ] -> [ Portal:blue:up| ][ PortalExit:orange:down BlockPlayer RotateUD ]

  (1DR)
  down  [ Portal:blue:down| WantU BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:right No WithCollision No WantR ] -> [ Portal:blue:down| ][ PortalExit:orange:right BlockPlayer RotateDR ]
  (1DL)
  down  [ Portal:blue:down| WantU BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:left No WithCollision No WantL ] -> [ Portal:blue:down| ][ PortalExit:orange:left BlockPlayer RotateDL ]
  (1DU)
  down  [ Portal:blue:down| WantU BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:up No WithCollision No WantU ] -> [ Portal:blue:down| ][ PortalExit:orange:up BlockPlayer RotateDU ]
  (1DD)
  down  [ Portal:blue:down| WantU BlockPlayer BPEnteringPortal1 ][ PortalExit:orange:down No WithCollision No WantD ] -> [ Portal:blue:down| ][ PortalExit:orange:down BlockPlayer RotateDD ]

  (2RR)
  right [ Portal:orange:right| WantL BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:right No WithCollision No WantR ] -> [ Portal:orange:right| ][ PortalExit:blue:right BlockPlayer RotateRR ]
  (2RL)
  right [ Portal:orange:right| WantL BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:left No WithCollision No WantL ] -> [ Portal:orange:right| ][ PortalExit:blue:left BlockPlayer RotateRL ]
  (2RU)
  right [ Portal:orange:right| WantL BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:up No WithCollision No WantU ] -> [ Portal:orange:right| ][ PortalExit:blue:up BlockPlayer RotateRU ]
  (2RD)
  right [ Portal:orange:right| WantL BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:down No WithCollision No WantD ] -> [ Portal:orange:right| ][ PortalExit:blue:down BlockPlayer RotateRD ]

  (2LR)
  left  [ Portal:orange:left| WantR BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:right No WithCollision No WantR ] -> [ Portal:orange:left| ][ PortalExit:blue:right BlockPlayer RotateLR ]
  (2LL)
  left  [ Portal:orange:left| WantR BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:left No WithCollision No WantL ] -> [ Portal:orange:left| ][ PortalExit:blue:left BlockPlayer RotateLL ]
  (2LU)
  left  [ Portal:orange:left| WantR BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:up No WithCollision No WantU ] -> [ Portal:orange:left| ][ PortalExit:blue:up BlockPlayer RotateLU ]
  (2LD)
  left  [ Portal:orange:left| WantR BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:down No WithCollision No WantD ] -> [ Portal:orange:left| ][ PortalExit:blue:down BlockPlayer RotateLD ]

  (2UR)
  up    [ Portal:orange:up| WantD BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:right No WithCollision No WantR ] -> [ Portal:orange:up| ][ PortalExit:blue:right BlockPlayer RotateUR ]
  (2UL)
  up    [ Portal:orange:up| WantD BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:left No WithCollision No WantL ] -> [ Portal:orange:up| ][ PortalExit:blue:left BlockPlayer RotateUL ]
  (2UU)
  up    [ Portal:orange:up| WantD BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:up No WithCollision No WantU ] -> [ Portal:orange:up| ][ PortalExit:blue:up BlockPlayer RotateUU ]
  (2UD)
  up    [ Portal:orange:up| WantD BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:down No WithCollision No WantD ] -> [ Portal:orange:up| ][ PortalExit:blue:down BlockPlayer RotateUD ]

  (2DR)
  down  [ Portal:orange:down| WantU BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:right No WithCollision No WantR ] -> [ Portal:orange:down| ][ PortalExit:blue:right BlockPlayer RotateDR ]
  (2DL)
  down  [ Portal:orange:down| WantU BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:left No WithCollision No WantL ] -> [ Portal:orange:down| ][ PortalExit:blue:left BlockPlayer RotateDL ]
  (2DU)
  down  [ Portal:orange:down| WantU BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:up No WithCollision No WantU ] -> [ Portal:orange:down|  ][ PortalExit:blue:up BlockPlayer RotateDU ]
  (2DD)
  down  [ Portal:orange:down| WantU BlockPlayer BPEnteringPortal2 ][ PortalExit:blue:down No WithCollision No WantD ] -> [ Portal:orange:down| ][ PortalExit:blue:down BlockPlayer RotateDD ]
 
endloop


(remove these things again)
[ RigidEnteringPortal1 ] -> []
[ RigidEnteringPortal2 ] -> []
[ RigidLeavingPortal1 ] -> []
[ RigidLeavingPortal2 ] -> []
[ BPEnteringPortal1 ] -> []
[ BPEnteringPortal2 ] -> []
[ BPLeavingPortal1 ] -> []
[ BPLeavingPortal2 ] -> []




[ NoPortal1 ] -> []
[ NoPortal2 ] -> []

( Rotation ! )
 [ Rotate ] -> [ Rotate ] sfx4 (a bit of a hack, but this is always created after a teleportation)

 color [ RotateCNW  Block___R:color ] -> [  Block_D__:color ]
 color [ RotateCNW  Block_D__:color] -> [  Block__L_:color ]
 color [ RotateCNW  Block__L_:color] -> [  BlockU___:color ]
 color [ RotateCNW  BlockU___:color] -> [  Block___R:color ]
 
 directions [ RotateCNW Player:blue:directions   ]-> [ Player:blue:rotate_directions_cw ]
 directions [ RotateCNW Player:orange:directions ]-> [ Player:orange:rotate_directions_cw ]


 color [ RotateCW   Block_D__:color] -> [  Block___R:color ]
 color [ RotateCW   Block__L_:color] -> [  Block_D__:color ]
 color [ RotateCW   BlockU___:color] -> [  Block__L_:color ]
 color [ RotateCW   Block___R:color] -> [  BlockU___:color ]

 directions [ RotateCW Player:blue:directions   ]-> [ Player:blue:rotate_directions_cnw ]
 directions [ RotateCW Player:orange:directions ]-> [ Player:orange:rotate_directions_cnw ]

 color [ RotatePerpendicular   BlockUD__:color] -> [  Block__LR:color ]
 color [ RotatePerpendicular   Block__LR:color] -> [  BlockUD__:color ]
 
 vertical_tag   [ FlipVertical Player:blue:vertical_tag   ]-> [ Player:blue:flip_vertical ]
 vertical_tag   [ FlipVertical Player:orange:vertical_tag ]-> [ Player:orange:flip_vertical ]


 color [ FlipVertical    Block_D__:color ] -> [  BlockU___:color ]
 color [ FlipVertical    BlockU___:color ] -> [  Block_D__:color ]
 color [ FlipHorizontal  Block___R:color ] -> [  Block__L_:color ]
 color [ FlipHorizontal  Block__L_:color ] -> [  Block___R:color ]
 
 horizontal_tag [ FlipHorizontal Player:blue:horizontal_tag ] -> [ Player:blue:flip_horizontal ]
 horizontal_tag [ FlipHorizontal Player:orange:horizontal_tag ] -> [ Player:orange:flip_horizontal ]
 

 [ Rotate ] -> [  ] 


( detect broken rigids )
right [ With:right | With:left ] -> [ With:right OkRigidR | With:left OkRigidL ] 
up    [ With:up | With:down ] -> [ With:up OkRigidU | With:down OkRigidD ] 


right [ With:right | Portal:blue:left]  -> [ RigidEnteringPortal1 With:right | Portal:blue:left]
left  [ With:left | Portal:blue:right]  -> [ RigidEnteringPortal1 With:left | Portal:blue:right]
up    [ With:up | Portal:blue:down]  -> [ RigidEnteringPortal1 With:up | Portal:blue:down]
down  [ With:down | Portal:blue:up]  -> [ RigidEnteringPortal1 With:down | Portal:blue:up]
right [ With:right | Portal:orange:left]  -> [ RigidEnteringPortal2 With:right | Portal:orange:left]
left  [ With:left | Portal:orange:right]  -> [ RigidEnteringPortal2 With:left | Portal:orange:right]
up    [ With:up | Portal:orange:down]  -> [ RigidEnteringPortal2 With:up | Portal:orange:down]
down  [ With:down | Portal:orange:up]  -> [ RigidEnteringPortal2 With:down | Portal:orange:up]


right [ With:right | Portal:blue:left][ RigidEnteringPortal2 ] -> [ With:right OkRigidR | Portal:blue:left][ RigidEnteringPortal2 ]
left  [ With:left | Portal:blue:right][ RigidEnteringPortal2 ] -> [ With:left OkRigidL | Portal:blue:right][ RigidEnteringPortal2 ]
up    [ With:up | Portal:blue:down][ RigidEnteringPortal2 ] -> [ With:up OkRigidU | Portal:blue:down][ RigidEnteringPortal2 ]
down  [ With:down | Portal:blue:up][ RigidEnteringPortal2 ] -> [ With:down OkRigidD | Portal:blue:up][ RigidEnteringPortal2 ]
right [ With:right | Portal:orange:left][ RigidEnteringPortal1 ] -> [ With:right OkRigidR | Portal:orange:left][ RigidEnteringPortal1 ]
left  [ With:left | Portal:orange:right][ RigidEnteringPortal1 ] -> [ With:left OkRigidL | Portal:orange:right][ RigidEnteringPortal1 ]
up    [ With:up | Portal:orange:down][ RigidEnteringPortal1 ] -> [ With:up OkRigidU | Portal:orange:down][ RigidEnteringPortal1 ]
down  [ With:down | Portal:orange:up][ RigidEnteringPortal1 ] -> [ With:down OkRigidD | Portal:orange:up][ RigidEnteringPortal1 ]

[ RigidEnteringPortal1 ] -> []
[ RigidEnteringPortal2 ] -> []


[ With:right no OkRigidR ] -> sfx5
([ With:right no OkRigidR ] -> cancel)
[ With:left no OkRigidL ] -> sfx5
([ With:left no OkRigidL ] -> cancel)
[ With:up no OkRigidU ] -> sfx5
([ With:up no OkRigidU ] -> cancel)
[ With:down no OkRigidD ] -> sfx5
([ With:down no OkRigidD ] -> cancel)



([ Error ] -> cancel sfx5)
([ Error ] -> [ ErrorSprite ])
[ Error ] -> [ ]

[ Want ] -> sfx5
([ Want ] -> cancel )
[ OkRigid ] -> []


( Create Light Bridge )
[ LightBridgeStarter:> no LightBridge:> no LightBridge:< ] -> [ LightBridgeStarter:> LightBridge:> ]



[ LightBridgeEnteringPortal:portal_color ] -> [ ]


( Spread light Bridge, including Portals )
startloop
   [ LightBridge:> | no LightBridge:> no LightBridge:< no DarkOrWhiteWall no Portal:< ] -> [ LightBridge:> | LightBridge:> ]
   
   
   portal_color [ LightBridge:> no LightBridgeEnteringPortal:portal_color | Portal:portal_color:< ] -> [ LightBridge:> LightBridgeEnteringPortal:portal_color | Portal:portal_color:< ]
   
   portal_color [ LightBridgeEnteringPortal:toggle_portal_color ][ Portal:portal_color:> | no LightBridge:< no LightBridge:> no DarkOrWhiteWall ] -> [ LightBridgeEnteringPortal:toggle_portal_color ][ Portal:portal_color:> | LightBridge:> ]


endloop

(start sink)
startloop
   [ Block Water no LightBridge ] -> [ Block MightSink Water ]
   ( contiguous to might sink, spread it )
   left  [ MightSink With:left | With:right no MightSink ] -> [ MightSink With:left | With:right MightSink ]
   right  [ MightSink With:right | With:left no MightSink ] -> [ MightSink With:right | With:left MightSink ]
   up  [ MightSink With:up | With:down no MightSink ] -> [ MightSink With:up | With:down MightSink ]
   down  [ MightSink With:down | With:up no MightSink ] -> [ MightSink With:down | With:up MightSink ]
endloop

startloop
   [ MightSink LightBridge ] -> [ Error MightSink LightBridge ]
   [ MightSink no Water ] -> [ Error MightSink ]

   ( contiguous to error, spread it )
   left  [ MightSink With:left Error | With:right MightSink no Error ] -> [ MightSink With:left Error | With:right MightSink Error ]
   right  [ MightSink With:right Error | With:left MightSink no Error ] -> [ MightSink With:right Error | With:left MightSink Error ]
   down  [ MightSink With:down Error | With:up MightSink no Error ] -> [ MightSink With:down Error | With:up MightSink Error ]
   up [ MightSink With:up Error | With:down MightSink no Error ] -> [ MightSink With:up Error | With:down MightSink Error ]
   
   left [ MightSink With:left | ActivePortal:right ] -> [ MightSink With:left Error | ActivePortal:right ]
   right [ MightSink With:right | ActivePortal:left ] -> [ MightSink With:right Error | ActivePortal:left ]
   up [ MightSink With:up | ActivePortal:down ] -> [ MightSink With:up Error | ActivePortal:down ]
   down [ MightSink With:down | ActivePortal:up ] -> [ MightSink With:down Error | ActivePortal:up ]
   
   
endloop

[ MightSink Error ] -> [ ]
[ Error ] -> []

[ MightSink LightBridge ] -> [ LightBridge ]

color [ MightSink Block____:color   Water ] -> [ Bridge____:color   ] sfx6
color [ MightSink Block___R:color   Water ] -> [ Bridge___R:color   ] sfx6
color [ MightSink Block__L_:color   Water ] -> [ Bridge__L_:color   ] sfx6
color [ MightSink Block__LR:color   Water ] -> [ Bridge__LR:color   ] sfx6
color [ MightSink Block_D__:color   Water ] -> [ Bridge_D__:color   ] sfx6
color [ MightSink Block_D_R_1:color Water ] -> [ Bridge_D_R_1:color ] sfx6
color [ MightSink Block_D_R_2:color Water ] -> [ Bridge_D_R_2:color ] sfx6
color [ MightSink Block_DL__1:color Water ] -> [ Bridge_DL__1:color ] sfx6
color [ MightSink Block_DL__2:color Water ] -> [ Bridge_DL__2:color ] sfx6
color [ MightSink Block_DLR:color   Water ] -> [ Bridge_DLR:color   ] sfx6
color [ MightSink BlockU___:color   Water ] -> [ BridgeU___:color   ] sfx6
color [ MightSink BlockU__R_1:color Water ] -> [ BridgeU__R_1:color ] sfx6
color [ MightSink BlockU__R_2:color Water ] -> [ BridgeU__R_2:color ] sfx6
color [ MightSink BlockU_L__1:color Water ] -> [ BridgeU_L__1:color ] sfx6
color [ MightSink BlockU_L__2:color Water ] -> [ BridgeU_L__2:color ] sfx6
color [ MightSink BlockU_LR:color   Water ] -> [ BridgeU_LR:color   ] sfx6
color [ MightSink BlockUD__:color   Water ] -> [ BridgeUD__:color   ] sfx6
color [ MightSink BlockUD_R:color   Water ] -> [ BridgeUD_R:color   ] sfx6
color [ MightSink BlockUDL_:color   Water ] -> [ BridgeUDL_:color   ] sfx6
color [ MightSink BlockUDLR_1:color Water ] -> [ BridgeUDLR_1:color ] sfx6
color [ MightSink BlockUDLR_2:color Water ] -> [ BridgeUDLR_2:color ] sfx6


[ Portal  no WithWhite ] -> [  ]


[ SinkingPlayerSprite3 ] -> [ ]
[ SinkingPlayerSprite2 ] -> [ SinkingPlayerSprite3 ] again
[ SinkingPlayerSprite1 ] -> [ SinkingPlayerSprite2 ] again
[ RealPlayer Water no LightBridge ] -> [ Water SinkingPlayerSprite1 MissingPlayer ] sfx7 again

   



( cleanup errors )

[ PostError ] -> []
[ Error ] -> []



(delete portal helpers, see ya next turn)
[ PortalExit ] -> [ ]
[ ActivePortal ] -> []


( Decorative rules )


[ Portal1Sprite no Portal:blue ] -> []
[ Portal1RS4 ] -> [  ]
[ Portal1LS4 ] -> [  ]
[ Portal1US4 ] -> [  ]
[ Portal1DS4 ] -> [  ]
[ Portal1RS3 ] -> [ Portal1RS4 ]
[ Portal1LS3 ] -> [ Portal1LS4 ]
[ Portal1US3 ] -> [ Portal1US4 ]
[ Portal1DS3 ] -> [ Portal1DS4 ]
[ Portal1RS2 ] -> [ Portal1RS3 ]
[ Portal1LS2 ] -> [ Portal1LS3 ]
[ Portal1US2 ] -> [ Portal1US3 ]
[ Portal1DS2 ] -> [ Portal1DS3 ]
[ Portal1RS1 ] -> [ Portal1RS2 ]
[ Portal1LS1 ] -> [ Portal1LS2 ]
[ Portal1US1 ] -> [ Portal1US2 ]
[ Portal1DS1 ] -> [ Portal1DS2 ]
[ Portal:blue:right no Portal1Sprite ] -> [ Portal:blue:right Portal1RS1 ]
[ Portal:blue:left no Portal1Sprite ] -> [ Portal:blue:left Portal1LS1 ]
[ Portal:blue:up no Portal1Sprite ] -> [ Portal:blue:up Portal1US1 ]
[ Portal:blue:down no Portal1Sprite ] -> [ Portal:blue:down Portal1DS1 ]

[ Portal2Sprite no Portal:orange ] -> []
[ Portal2RS4 ] -> [  ]
[ Portal2LS4 ] -> [  ]
[ Portal2US4 ] -> [  ]
[ Portal2DS4 ] -> [  ]
[ Portal2RS3 ] -> [ Portal2RS4 ]
[ Portal2LS3 ] -> [ Portal2LS4 ]
[ Portal2US3 ] -> [ Portal2US4 ]
[ Portal2DS3 ] -> [ Portal2DS4 ]
[ Portal2RS2 ] -> [ Portal2RS3 ]
[ Portal2LS2 ] -> [ Portal2LS3 ]
[ Portal2US2 ] -> [ Portal2US3 ]
[ Portal2DS2 ] -> [ Portal2DS3 ]
[ Portal2RS1 ] -> [ Portal2RS2 ]
[ Portal2LS1 ] -> [ Portal2LS2 ]
[ Portal2US1 ] -> [ Portal2US2 ]
[ Portal2DS1 ] -> [ Portal2DS2 ]
[ Portal:orange:right no Portal2Sprite ] -> [ Portal:orange:right Portal2RS1 ]
[ Portal:orange:left no Portal2Sprite ] -> [ Portal:orange:left Portal2LS1 ]
[ Portal:orange:up no Portal2Sprite ] -> [ Portal:orange:up Portal2US1 ]
[ Portal:orange:down no Portal2Sprite ] -> [ Portal:orange:down Portal2DS1 ]


[ DarkWall no DarkWallSprite ] -> [ DarkWall random DarkWallSprite ]
[ RealTimeTick ][ WaterSprite ] -> [RealTimeTick][]
[ RealTimeTick ][ Water no WaterSprite ] -> [RealTimeTick][ Water random WaterSprite ]


up    [ no HasCellU | ] -> [ HasCellU | ]
down  [ no HasCellD | ] -> [ HasCellD | ]
right [ no HasCellR | ] -> [ HasCellR | ]
left  [ no HasCellL | ] -> [ HasCellL | ]

up   [ DarkWall no HasCellU no DarkWallTop  ] -> [ DarkWall DarkWallTop ]
left [ DarkWall no HasCellL no DarkWallLeft ] -> [ DarkWall DarkWallLeft ]
right[ DarkWall no HasCellR no DarkWallRight ] -> [ DarkWall DarkWallRight ]
down [ DarkWall no HasCellD no DarkWallBottom] -> [ DarkWall DarkWallBottom ]


up   [ DarkWall no DarkWallTop  | no DarkOrWhiteWall ] -> [ DarkWall DarkWallTop |]
left [ DarkWall no DarkWallLeft | no DarkOrWhiteWall ] -> [ DarkWall DarkWallLeft|]
right[ DarkWall no DarkWallRight| no DarkOrWhiteWall ] -> [ DarkWall DarkWallRight|]
down [ DarkWall no DarkWallBottom | no DarkOrWhiteWall ] -> [ DarkWall DarkWallBottom|]

up   [ Wall no WallTop:white  | no DarkOrWhiteWall ] -> [ Wall WallTop:white |]
left [ Wall no WallLeft:white | no DarkOrWhiteWall ] -> [ Wall WallLeft:white|]
right[ Wall no WallRight:white| no DarkOrWhiteWall ] -> [ Wall WallRight:white|]
down [ Wall no WallBottom:white | no DarkOrWhiteWall ] -> [ Wall WallBottom:white|]

up   [ Wall no HasCellU ] -> [ Wall WallTop:white ]
left [ Wall no HasCellL ] -> [ Wall WallLeft:white]
right[ Wall no HasCellR ] -> [ Wall WallRight:white]
down [ Wall no HasCellD ] -> [ Wall WallBottom:white]


[ no HasCellU no  HasCellL ] -> [ CellOdd ]

startloop
  [ CellOdd  | no CellEven ] -> [ CellOdd  | CellEven ]
  [ CellEven | no CellOdd  ] -> [ CellEven | CellOdd ]
endloop

[ Wall CellOdd ] -> [ Wall WallOdd CellOdd ]



[ WallBottom:white WallTop:white WallLeft:white WallRight:white no Wallx1:white ] -> [ WallBottom:white WallTop:white WallLeft:white WallRight:white Wallx1:white ]


down  [ Wall | DarkWall ] -> [ Wall | WallSeparatorU DarkWall ]
up    [ Wall | DarkWall ] -> [ Wall | WallSeparatorD DarkWall ]
left  [ Wall | DarkWall ] -> [ Wall | WallSeparatorR DarkWall ]
right [ Wall | DarkWall ] -> [ Wall | WallSeparatorL DarkWall ]


right [ Wall        | WallBottom:white ] -> [ action Wall | WallBottom:white ]
down  [ action Wall | WallRight:white  ] -> [        Wall WallDarkCorner:white | WallRight:white  ]
[ action Wall ] -> [ Wall ]


up   [ no Water no Bridge no GroundTop   | WaterOrBridge ] -> [ GroundTop   | WaterOrBridge ]
left [ no Water no Bridge no GroundLeft  | WaterOrBridge ] -> [ GroundLeft  | WaterOrBridge ]
right[ no Water no Bridge no GroundRight | WaterOrBridge ] -> [ GroundRight | WaterOrBridge ]
down [ no Water no Bridge no GroundBottom| WaterOrBridge ] -> [ GroundBottom| WaterOrBridge ]

up   [ Target no TargetBorderTop    | Target ] -> [ Target  TargetBorderTop    | Target ]
down [ Target no TargetBorderBottom | Target ] -> [ Target  TargetBorderBottom | Target ]
left [ Target no TargetBorderLeft   | Target ] -> [ Target  TargetBorderLeft   | Target ]
right[ Target no TargetBorderRight  | Target ] -> [ Target  TargetBorderRight  | Target ]


[ Target Block no WithWhite no GoalSoundSprite ] -> [ Target Block GoalSoundSprite ] sfx10
[ Target no Block GoalSoundSprite  ] -> [ Target ] sfx9
[ Target WithWhite GoalSoundSprite ] -> [ Target WithWhite ] sfx9

directions_tag [ LightBridgeSprite:smod3:directions_tag no LightBridge:directions_tag ]  -> []

(play sfx if there are new light bridge sprites)
[ LightBridge:directions no LightBridgeSprite:smod3:directions ] -> [ LightBridge:directions ] sfx11

directions_tag [ LightBridgeSprite:s2:directions_tag ] -> [ ]
directions_tag [ LightBridgeSprite:s1:directions_tag ] -> [ LightBridgeSprite:s2:directions_tag ]
directions_tag [ LightBridgeSprite:s0:directions_tag ] -> [ LightBridgeSprite:s1:directions_tag ]

directions_tag [ LightBridge:directions_tag no LightBridgeSprite:directions_tag ] -> [ LightBridge:directions_tag  LightBridgeSprite:s0:directions_tag ]

( /Decorative Rules)

==============
WINCONDITIONS
==============

All target on Block
No WithWhite on Target
Some Player
Some Target

=======
LEVELS
=======

Message Welcome to [Redacted] Science.
Message Your clearance level is so low that we can't even share the name of the company with you.
Message Your Job is simple: Relocate the furniture to the marked locations. 'Z' to undo. 'R' to restart.

section 01

%%%%%%%%%%
%01...@.@%
%01...@..%
###..¡.%.%
####...%.%
####s╎☥%.%
####pay%.%
%%%@yyy%.%
%@@@.....%
%%%%%%%%%%

section 02

Message At [Redacted] Science we value your safety. For that reason some restricted areas may be surrounded by safety liquid.

Message We do not recommend to submerge into the safety liquid 


%##%%%%%%%%%%%%%
%02%%%...~~.yy¡%
%02..yyy.%~~~~~%
%....y.y%%.....%
%...#...%%.yy.%%
%...#..%%%.%.%%%
%...#..~~..~..#%
%...#%%~~~~~.T#%
%@@@yy..~..~...%
%@.@.......~~~~%
%%%%%%%%%%%%%%%%


section 03

Message Friendly Reminder to all personnel: In the rare case you stumble upon any [Redacted] Science Test Equipment, you should leave it untouched and report the incident to IT.


###%%%%%%%%%
##........%%
##@@@@yyyy%%
##@.@@y..y%%
%%%.@%%....%
%%%%%y@y...%
#....y@y.03%
#..!.y@..03%
#%%%%%%%%%%%


section 04

Message Unsupervised exposure to [Redacted] Science Test Equipment might damage our furniture. It might also lead to death.

%%%%%%%%%%%%
%04....~~~%%
%04┦.~~~.~@%
%!.c.~~~.~.%
%.ñc.~~~.~.%
%..⹏.~...~.%
%....~...~.%
########%%%%



Message Rest assured that this is not a test. This is a job for humans.
Message There are no records being kept of the number of moves you are using and we don't look at any leaderboards.

section 05

%%%%%%%%%%%%%#%
%05........%.@%
%05....%~~~~.@%
%.⡧ⱬⱬℌ┦~~~~~.@%
%.c⅄☥cc~~~~~.@%
%.⸔ⱬⱬac~~~~~.%%
%.....⹏~~~~~~~%
%...!..~~~~~~~%
%###########%%%

Message If this was a test, I would have no reason to lie about it. Therefore, this is not a test.

section 06
%%%%%%%%%%%%#%%%%%
%#....~~.......06%
%%ñññ.~~.......06%
%%....~~~~~~~~~~~%
%%%%%~~~~~~~~~...%
%.....~~~.%%~..y.%
%.~~~!~~~.%%..yy%%
%.~~@.~~..#%.%#%%%
%.~~~.~~%..yy.%%h%
%.....~~%%.......%
%%%%%#%%%%%%%%%%%%

section 07

Message What findings could there possibly be made from a test like this? "Subject can push large objects" "Subject understands object rotation" Statements dreamed up by the utterly deranged.

%%%%%%%%%%%%%
%%......%%%%%
%%......~...%
%..%y%..~.~@%
#.y.y.~.~~~%%
#...y.~~~.~%%
#...y.~.07~%%
#.....~!07~%%
#########%%%%

section 08

Message Your Job is to cover all marked areas with furniture that have the [Redacted] Science Design Department-Approved Yellow Color. That's the exact job description.

Message Just imagine just how many more tasks a Test Subject would have to do instead. Aren't you glad that your job is much simpler and mundane?

#############
#.#.#...#...#
#.....#.##@@#
#.%.yyy..@@.#
#.%%..y..08##
#..yy.y!#08.#
##yy..y.###.#
#####@@@#@@@#
#############


section 09

Message Pieces of Furniture that are not in [Redacted] Science Interior Design Department-approved Yellow should be ignored.

%#######%%%%%%%%
%09....@~~~~~~.#
%09.....~~~~~~.#
%.......~~~~~~~%
%%ww%%..~~~~~~~%
#....%..~~~~~~~%
#....%..~~~~~~~%
#~~~~%..~~~....%
#..!.%..~~~.y..%
#%%%%%%%%%%####%


section 10

Message Our Scientists are busy making important discoveries such as solid light. They don't have time to be moving furniture around.
%%%%%%#%%%%
%10↓......%
%10.......%
%~~~~~~~~~%
%~~~~~~~~~%
%~~~~~~~~~%
%...%%.y.%%
%@!..%.yy%%
%@@..%...%%
%%%##%%#%%%


section 11

Message * Reviewing Past Performance Records *

Message The Previous employee in your role got Terminated because they were taking too long on moving the furniture for a certain chamber.

Message The records say: "Employee too easily distracted by bright lights". "Employee displays an inability to combine recently-learned concepts."

section 12

Message You appear to be taking quite some time to move a small piece of furniture.

Message Couldn't you be more efficient? If you could do more things at once, that'd make you a much more useful employee.


%%%%%%%%%%%%%%%%%%%
%..%%%%.....%%%%..%
%..YY.%.WWW.%.YY..%
%..Y..%..W..%..Y..%
%...@@%.@@@.%@@...%
%%%%@%%%%@%%%%@%%%%
%.................%
%12......!........%
%12.....WW}.......%
###################

section 13

Message Maybe what you could do is become more versatile? It's so tragic humans couldn't do more with less.

%%%%%%%%%%%%%%
%13.....~~~~~%
%13.!...~~~~~%
%......%.Y.~~%
%.W.W..%...~~%
%.WWWWW.~~~~@%
%.......~~~~.%
%%%%%%%%%%%%%%


section someoldone

%%%%%%%%%%%%%%%%
%@@............%
%@.............%
%~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~%
%~~~~~~~~~~~~~~%
#....ŧ%%....yy.%
#11.!.%#.ww.y..%
#11...%%%%%%%%%%
######%%%%%%%%%%




Message Just because you are not being tested doesn't mean your should slack off.

Message As unlikely as it may appear, these chambers took a lot of time to design.


section old09

%%%%%%%%%%%%%%
%............%
%.“»%%%%%%%%@%
%........%%%%%
%...%%..%%...%
%.ñ........09%
%%%%%.%.%%.09%
%%%%..%%%%%%%%
%%%%.!%%%%%%%%
%%%%..%%%%%%%%
%%%%%%%%%%%%%%

section old04

%%%%%%
%%%@%%
%04@@%
%04@@%
%~~..%
%..!~%
%sg..%
#pn.ñ%
#....%
%%%%#%



section old10

%%%%%%%%%%%%%%%%%%
%%%%%%.⅄☥.~....10%
%%%%%%..%.%....10%
%....%....%%%%%~%%
%....%.%%.%%%%%.%%
#@@..~.%~~~...!..%
%....~~~~~~..ñ...%
%~~~~~~~~~~..“·».%
%~~~~~~~~~~..“·».%
%%%%%%%%%%%%#%%%%%





section old11

Message As they say, you should aim to have as few mechanics as possible. That's why we've replaced all of the mechanics with repair robots.

%#%%%%%%%%%%%%%%%%
%@ñ┦%.....~~~....%
%..¢%.....~~~..@.%
%~~c%....┦~~~.@@.%
%!.c%.“»⅄a~~~.@@.%
%.⅄a%.“»⡧☥~~~.@..%
%..~~.“»⹏.~~~..11%
%%.~%.....~~~..11%
%%%%%%%%%%%%%%%%%%

Message Reminder to employees: Do not fill safety liquid pools with unused furniture unless absolutely necesssary.

section old12

%%%%%%%##%%%%%%%%
%%@%%%%~~.....12%
%%@%%%%~~..@@.12%
%%.....~~..@....%
%%.....~~.......%
%%~~~~~~~~~~~~~~%
%...............%
%..⡧☥#.!.“·»....%
%..⹏.%...⅄ⱬⱬⱬℌ..%
%....%.......⹏..%
%%%%%%%%%%%%%%%%%

Message [Redacted] Science would like to thank our surviving employees. Your efforts are noted.

section 13

%%%%%%%%%%%%%%%
%......~~~....%
%......~~~....%
%.“»!┦.~~~..@.%
%.“»⅄a.~~~.@@.%
%.“»┦..~~~.@@.%
%...⸔☥.~~~.@..%
%......~~~..13%
%......~~~..13%
%%%%%%%%%%%%%%%

Message Congratulations on making this far. If this was a test, the results would be very satisfactory.

section 14

%%%%%%%%%%%%%%%
%%%%%~~~......%
%%%%%~%~%%┦...%
%%%..~.~.%c...%
%%%.ñ~.~@%⹏.14%
%%%..~~~.%┦.14%
%%%%%~~~~%c..%%
%...#...#.⹏..%%
%.}}.~~.%...%%%
%.......%.┦.%%%
%%~~~~~~%.c.%%%
%%~~~~~~..⹏.%%%
%%...!.~..#.%%%
%%%%%%#%%%%%%%%




Message [ You've finished placing the furniture. Our test chambers are finally ready. ]

Message Good Job, Human.

section 15

%%%%%%%%%%%%%%%%%%%%
%..................%
%..................%
%.....ñ.ñ.ñ........%
%.....µ.µ.µ........%
%....┦\·”·æ┦.......%
%....⸔ⱬⱬⱬⱬⱬa.......%
%.............!....%
%..................%
%................66%
%................00%
%%%%%%%%%%%%%%%%%%%%



(

level_select_point (08)

Message joke

%%%%%%%%%%%%%%%
%o⑧.....~~@@@~%
%ö⑻⡧ⱬⱬⱬⱬℌ~..@~%
%..c....c~~~~~%
%..c....c~~~~~%
%..c....⹏~~~~~%
%..c....%.ñ~~~%
%..⹏.!..%..~~~%
%........~~~~@%
%.“···»..~~~~.%
%........~~~~~%
%........%%%%%%
%%%%%%%%%%%%%%%


Message sadsg

%%%%%%%%%%%%%%%
%.......~~@@@~%
%.......~~..@~%
%⡧ⱬⱬⱬⱬℌ.~~~~~~%
%c....c.~~~~~~%
%c....c.~~~~~~%
%c....⹏.%..o⑦~%
%c......%.ñö⑺~%
%⹏.“···».~~~~@%
%........~~~~.%
%...!....~~~~~%
%........~~~~~%
%%%%%%%%%%%%%%%


Message [ End of playtest, big congrats ]


(



#################
~...............#
~.......⡧ⱬℌ..!..#
~.......⹏.⹏.....#
~...#############
~...#############
~...#############
~............@@@#
~............@.@#
#################

#################
#...............#
#..⅄☥...⡧ⱬℌ⅄ⱬℌ..#
#....!..⹏.⹏..⸔6.#
#...####......c.#
#...###⅄☥..⅄ⱬⱬa.#
#...###..###.####
#............@@@#
#............@.@#
#################


#################
#...............#
#..⅄☥...⡧ⱬℌ.....#
#.......⹏.⹏.....#
#...####........#
#...######..!...#
#...######.#.####
#............@@@#
#............@.@#
@################





###################
############.....##
#..........#.....@#
#.!........#~~~~.##
#...#.⡧ⱬⱬℌ..~~~~..#
#.....c⅄☥c..~~~~..#
#...ñ.⸔ⱬⱬa..~~~~.##
#...............~##
#...............~##
#...............###
###################

#################
#...............#
#.......⡧ⱬℌ.....#
#.......⹏.⹏.....#
#...######......#
#...######..!...#
#...#############
#............@@@#
#............@.@#
#################







#################
#@@@@...##......#
#@..@...........#
#........⡧☥.⡧ⱬⱬℌ#
#....⡧ⱬℌ.c..⹏..⹏#
#....c!dⱬa......#
#####⸔ⱬa........#
#####.......#...#
#####...........#
#################



#################
#...............#
#...........@...#
#...............#
#....⡧ⱬℌ........#
#....c!c........#
#....⸔ⱬa........#
#...............#
#...............#
#################


#################
#...............#
#.......⡧ⱬℌ.....#
#.......⹏.⹏.....#
#...######......#
#...######..!...#
#...#############
#............@@@#
#............@.@#
#################


#################
#...............#
#.!..⅄ⱬ╎☥..ñ....#
#...#..⹏........#
#....⅄ℌ⅄ⱬ☥⅄☥..~.#
#..⡧ⱬℌ⸔ℌ┦.....~.#
#..⹏.⹏4⹏csg..~~.#
#.....⸔╎apn.~~~.#
#......⹏..~~~~~.#
#@..............#
#################
)
